@page
@model FrotiX.Models.Empenho

@{
    ViewData["Title"] = "Empenhos";
    ViewData["PageName"] = "empenho_index";
    ViewData["Heading"] = "<i class='fad fa-money-check-alt'></i> Cadastros: <span class='fw-300'>Empenhos</span>";
    ViewData["Category1"] = "Cadastros";
    ViewData["PageIcon"] = "fal fa-money-check-alt";
}

@section HeadBlock { }

<style>
    .fundo-cinza {
        background-color: #2F4F4F;
        color: aliceblue;
    }
</style>

<div class="row">
    <div class="col-xl-12">
        <div id="panel-1" class="panel">
            <div class="panel-container show">
                <div class="panel-content float-right">
                    <a href="/Empenho/Upsert" class="btn btn-azul" data-ejtip="Adicionar Novo Empenho">
                        <i class="fa-duotone fa-file-plus icon-space icon-pulse"></i> Adicionar Empenho
                    </a>
                </div>

                <div class="panel-content">
                    <div class="box-body">
                        <br />
                        <div class="col-12 px-3" style="border-bottom:1px solid #325d88">
                            <h2 class="text-primary">
                                Escolha um Instrumento (Contrato/Ata) para visualizar seus Empenhos:
                            </h2>
                        </div>

                        <div class="col-3">
                            <div class="form-group">
                                <label class="label font-weight-bold">Contrato/Ata</label>
                                <select id="lstInstrumento" class="form-control form-control-sm">
                                    <option value=""> -- Selecione um Instrumento -- </option>
                                    <option value="0">Contrato</option>
                                    <option value="1">Ata de Registro de Preços</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-12">
                            <div id="divContrato" class="form-group row" style="display:none">
                                <div class="col-2">
                                    <div class="form-group">
                                        <label class="label font-weight-bold">Status...</label>
                                        <select id="lstStatusContrato" class="form-control form-control-sm">
                                            <option value="1">Ativo</option>
                                            <option value="0">Inativo</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-5">
                                    <label class="label font-weight-bold">Contratos</label>
                                    <select id="ListaContratos" name="ListaContratos" class="form-control form-control-sm">
                                        <option value="">-- Selecione um Contrato --</option>
                                    </select>
                                </div>
                            </div>

                            <div id="divAta" class="form-group row" style="display:none">
                                <div class="col-2">
                                    <div class="form-group">
                                        <label class="label font-weight-bold">Status...</label>
                                        <select id="lstStatusAta" class="form-control form-control-sm">
                                            <option value="1">Ativa</option>
                                            <option value="0">Inativa</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-5">
                                    <label class="label font-weight-bold">Atas de Registro de Preço</label>
                                    <select id="ListaAtas" name="ListaAtas" class="form-control form-control-sm">
                                        <option value="">-- Selecione uma Ata --</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <br /><br />

                        <div id="divEmpenho" style="display:none">
                            <table id="tblEmpenho" class="table table-bordered table-striped" width="100%">
                                <thead>
                                    <tr>
                                        <th>Nota de Empenho</th>
                                        <th>Vigência Inicial</th>
                                        <th>Vigência Final</th>
                                        <th>Saldo Inicial</th>
                                        <th>Total de Movimentações</th>
                                        <th>Total de Notas Fiscais</th>
                                        <th>Saldo Atual</th>
                                        <th>Ação</th>
                                        <th>Aporte/Anulação</th>
                                        <th>EmpenhoId</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Aportar -->
<div class="modal fade" id="modalAporte">
    <div class="modal-dialog modal-lg" role="dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="DynamicModalLabel">Aportar Valores ao Empenho</h4>
            </div>

            <div class="modal-body table-bordered">
                <form id="frmAporte">
                    <input type="hidden" id="txtIdAporte" />
                    <div class="row">
                        <div class="col-5">
                            <div class="form-group">
                                <label class="font-weight-bold">Data do Aporte</label>
                                <input id="txtData" class="form-control form-control-xs" type="date" />
                            </div>
                        </div>
                        <div class="col-7">
                            <div class="form-group">
                                <label class="font-weight-bold">Descrição</label>
                                <input id="txtDescricao" class="form-control form-control-xs" />
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-3">
                            <div class="form-group">
                                <label class="font-weight-bold">Valor do Aporte</label>
                                <input id="txtValor" class="form-control form-control-xs" data-inputmask="'alias': 'currency'" style="text-align:right" onKeyPress="return(moeda(this,'.',',',event))" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="btnAportar" class="btn btn-azul" type="submit" value="SUBMIT">
                            <i class="fa-duotone fa-file-check icon-space icon-pulse"></i> Aportar
                        </button>
                        <button type="button" class="btn btn-vinho" data-dismiss="modal">
                            <i class="fa-solid fa-rotate-left icon-space icon-rotate-left"></i> Fechar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal Anulação -->
<div class="modal fade" id="modalAnulacao">
    <div class="modal-dialog modal-lg" role="dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="DynamicModalLabel">Anular Valores do Empenho</h4>
            </div>

            <div class="modal-body table-bordered">
                <form id="frmAnulacao">
                    <input type="hidden" id="txtIdAnulacao" />
                    <div class="row">
                        <div class="col-5">
                            <div class="form-group">
                                <label class="font-weight-bold">Data da Anulação</label>
                                <input id="txtDataanulacao" class="form-control form-control-xs" type="date" />
                            </div>
                        </div>
                        <div class="col-7">
                            <div class="form-group">
                                <label class="font-weight-bold">Descrição</label>
                                <input id="txtDescricaoanulacao" class="form-control form-control-xs" />
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-3">
                            <div class="form-group">
                                <label class="font-weight-bold">Valor da Anulação</label>
                                <input id="txtValoranulacao" class="form-control form-control-xs" data-inputmask="'alias': 'currency'" style="text-align:right" onKeyPress="return(moeda(this,'.',',',event))" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="btnAnular" class="btn btn-azul" type="submit" value="SUBMIT">
                            <i class="fa-duotone fa-file-check icon-space icon-pulse"></i> Anular
                        </button>
                        <button type="button" class="btn btn-vinho" data-dismiss="modal">
                            <i class="fa-solid fa-rotate-left icon-space icon-rotate-left"></i> Fechar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal Notas Fiscais -->
<div class="modal fade" id="modalNF">
    <div class="modal-dialog modal-lg" role="dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="DynamicModalLabel">Notas Fiscais do Empenho</h4>
            </div>

            <div class="modal-body table-bordered">
                <form id="frmNF">
                    <table id="tblNotaFiscal" class="table table-bordered table-striped" width="100%">
                        <thead>
                            <tr>
                                <th>Número da Nota</th>
                                <th>Data de Emissão</th>
                                <th>Valor</th>
                                <th>Valor de Glosa</th>
                                <th>Motivo da Glosa</th>
                                <th>Ação</th>
                                <th>ContratoId</th>
                                <th>EmpenhoId</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-vinho" data-dismiss="modal">
                            <i class="fa-solid fa-rotate-left icon-space icon-rotate-left"></i> Fechar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section ScriptsBlock {

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <script src="~/js/cadastros/empenho.js" asp-append-version="true"></script>

    <script>
        function brToNumberString(v) {
            try {
                if (v == null) return "0";
                return String(v).replace(/\s/g,'').replace(/\./g,'').replace(',', '.').replace('R$','').replace('&nbsp;','');
            } catch (error) {
                Alerta.TratamentoErroComLinha("Index.cshtml", "brToNumberString", error);
                return "0";
            }
        }

        $("#btnAportar").on("click", function (e) {
            try {
                e.preventDefault();

                console.log("txtDescricao:", $("#txtDescricao").val());
                console.log("txtData:", $("#txtData").val());
                console.log("txtValor:", $("#txtValor").val());

                if (!$("#txtData").val()) {
                    Alerta.Erro("Atenção", "A data do Aporte é obrigatória!");
                    return;
                }
                if (!$("#txtDescricao").val()) {
                    Alerta.Erro("Atenção", "A descrição do Aporte é obrigatória!");
                    return;
                }
                if (!$("#txtValor").val()) {
                    Alerta.Erro("Atenção", "O valor do Aporte é obrigatório!");
                    return;
                }

                const valorAporte = brToNumberString($("#txtValor").val());

                const objEmpenho = JSON.stringify({
                    EmpenhoId: $('#txtIdAporte').val(),
                    Descricao: $('#txtDescricao').val(),
                    Valor: valorAporte,
                    DataMovimentacao: $('#txtData').val(),
                    TipoMovimentacao: "A"
                });

                $.ajax({
                    type: "post",
                    url: "/api/Empenho/Aporte",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: objEmpenho,
                    success: function (data) {
                        try {
                            AppToast.show('Verde', data.message );
                            $('#tblEmpenho').DataTable().ajax.reload(null, false);
                            $("#modalAporte").modal('hide');
                            $('#frmAporte')[0].reset();
                        } catch (error) {
                            Alerta.TratamentoErroComLinha("Index.cshtml", "btnAportar.success", error);
                        }
                    },
                    error: function (data) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "btnAportar.error", data);
                    }
                });

            } catch (error) {
                Alerta.TratamentoErroComLinha("Index.cshtml", "btnAportar.click", error);
            }
        });

        $("#btnAnular").on("click", function (e) {
            try {
                e.preventDefault();

                console.log("txtDescricaoanulacao:", $("#txtDescricaoanulacao").val());
                console.log("txtDataanulacao:", $("#txtDataanulacao").val());
                console.log("txtValoranulacao:", $("#txtValoranulacao").val());

                if (!$("#txtDataanulacao").val()) {
                    Alerta.Erro("Atenção", "A data da anulação é obrigatória!");
                    return;
                }
                if (!$("#txtDescricaoanulacao").val()) {
                    Alerta.Erro("Atenção", "A descrição da anulação é obrigatória!");
                    return;
                }
                if (!$("#txtValoranulacao").val()) {
                    Alerta.Erro("Atenção", "O valor da anulação é obrigatório!");
                    return;
                }

                const valorAnulacao = brToNumberString($("#txtValoranulacao").val());

                const objEmpenho = JSON.stringify({
                    EmpenhoId: $('#txtIdAnulacao').val(),
                    Descricao: $('#txtDescricaoanulacao').val(),
                    Valor: valorAnulacao,
                    DataMovimentacao: $('#txtDataanulacao').val(),
                    TipoMovimentacao: "G"
                });

                $.ajax({
                    type: "post",
                    url: "/api/Empenho/anulacao",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: objEmpenho,
                    success: function (data) {
                        try {
                            AppToast.show('Verde', data.message );
                            $('#tblEmpenho').DataTable().ajax.reload(null, false);
                            $("#modalAnulacao").modal('hide');
                            $('#frmAnulacao')[0].reset();
                        } catch (error) {
                            Alerta.TratamentoErroComLinha("Index.cshtml", "btnAnular.success", error);
                        }
                    },
                    error: function (data) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "btnAnular.error", data);
                    }
                });

            } catch (error) {
                Alerta.TratamentoErroComLinha("Index.cshtml", "btnAnular.click", error);
            }
        });
    </script>

    <script>
        $(document).ready(function () {
            try {
                $("#modalAporte").modal({
                    keyboard: true,
                    backdrop: "static",
                    show: false
                }).on("show.bs.modal", function (event) {
                    try {
                        var button = $(event.relatedTarget);
                        var empenhoId = button.data("id");

                        var notaEmpenho = $(event.relatedTarget).closest("tr").find("td:eq(0)").text();

                        $(this).find("#DynamicModalLabel").html($("<b>Aportar Valor ao Empenho: " + notaEmpenho + "</b>"));
                        $('#btnAportar').attr('data-id', empenhoId);
                        $('#txtIdAporte').val(empenhoId);
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "modalAporte.show", error);
                    }
                }).on("hide.bs.modal", function () {
                    try {
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "modalAporte.hide", error);
                    }
                });

                $("#modalAnulacao").modal({
                    keyboard: true,
                    backdrop: "static",
                    show: false
                }).on("show.bs.modal", function (event) {
                    try {
                        var button = $(event.relatedTarget);
                        var empenhoId = button.data("id");

                        var notaEmpenho = $(event.relatedTarget).closest("tr").find("td:eq(0)").text();

                        $(this).find("#DynamicModalLabel").html($("<b>Anular Valor do Empenho: " + notaEmpenho + "</b>"));
                        $('#btnAnular').attr('data-id', empenhoId);
                        $('#txtIdAnulacao').val(empenhoId);
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "modalAnulacao.show", error);
                    }
                });

                $("#modalNF").modal({
                    keyboard: true,
                    backdrop: "static",
                    show: false
                }).on("show.bs.modal", function (event) {
                    try {
                        var button = $(event.relatedTarget);
                        var empenhoId = button.data("id");

                        console.log("Empenho:", empenhoId);

                        if ($.fn.DataTable.isDataTable('#tblNotaFiscal')) {
                            $('#tblNotaFiscal').DataTable().destroy();
                        }

                        $('#tblNotaFiscal').DataTable({
                            columnDefs: [
                                { targets: 0, className: "text-center", width: "8%" },
                                { targets: 1, className: "text-center", width: "8%" },
                                { targets: 2, className: "text-right",  width: "10%" },
                                { targets: 3, className: "text-right",  width: "8%" },
                                { targets: 4, className: "text-left",   width: "15%" },
                                { targets: 5, className: "text-center", width: "8%", visible: false },
                                { targets: 6, className: "text-center", width: "10%", visible: false },
                                { targets: 7, className: "text-center", width: "10%", visible: false }
                            ],
                            responsive: true,
                            ajax: {
                                url: "/api/notafiscal/nfempenhos",
                                data: { id: empenhoId },
                                type: "GET",
                                datatype: "json"
                            },
                            columns: [
                                { data: "numeroNF" },
                                { data: "dataFormatada" },
                                { data: "valorNFFormatado" },
                                { data: "valorGlosaFormatado" },
                                { data: "motivoGlosa" },
                                {
                                    data: "notaFiscalId",
                                    render: function (data) {
                                        return `
                                            <div class="text-center">
                                                <a href="/NotaFiscal/Upsert?id=${data}" class="btn btn-azul text-white" data-ejtip="Editar a Nota Fiscal" style="cursor:pointer; padding: 2px 6px !important; font-size: 12px !important; margin: 1px !important;">
                                                    <i class="far fa-edit"></i>
                                                </a>
                                                <a class="btn btn-delete btn-vinho text-white" data-ejtip="Excluir a Nota Fiscal" style="cursor:pointer; padding: 2px 6px !important; font-size: 12px !important; margin: 1px !important;" data-id='${data}'>
                                                    <i class="far fa-trash-alt"></i>
                                                </a>
                                            </div>`;
                                    }
                                },
                                { data: "contratoId" },
                                { data: "empenhoId" }
                            ],
                            language: {
                                url: "https://cdn.datatables.net/plug-ins/1.10.25/i18n/Portuguese-Brasil.json",
                                emptyTable: "Sem Dados para Exibição"
                            },
                            width: "100%"
                        });

                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "modalNF.show", error);
                    }
                });

                $("#lstInstrumento").on('change', function () {
                    try {
                        const val = $(this).val();
                        if (val === '0') {
                            $("#divContrato").show();
                            $("#divAta").hide();
                            $('#ListaContratos').empty();
                            loadListaContratos(1);
                        } else if (val === '1') {
                            $("#divAta").show();
                            $("#divContrato").hide();
                            $('#ListaAtas').empty();
                            loadListaAtas(1);
                        } else {
                            $("#divAta, #divContrato").hide();
                        }
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "lstInstrumento.change", error);
                    }
                });

                $("#lstStatusContrato").on('change', function () {
                    try {
                        $('#ListaContratos').empty();
                        loadListaContratos($(this).val());
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "lstStatusContrato.change", error);
                    }
                });

                $("#lstStatusAta").on('change', function () {
                    try {
                        $('#ListaAtas').empty();
                        loadListaAtas($(this).val());
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "lstStatusAta.change", error);
                    }
                });

                function loadListaContratos(status) {
                    try {
                        $.ajax({
                            type: "get",
                            url: "/api/Contrato/ListaContratos",
                            data: { id: status },
                            success: function (res) {
                                try {
                                    let option = '<option>-- Selecione um Contrato --</option>';
                                    if (res && res.data && res.data.length) {
                                        res.data.forEach(function (obj) {
                                            option += `<option value="${obj.value}">${obj.text}</option>`;
                                        });
                                    }
                                    $('#ListaContratos').empty().append(option);
                                } catch (error) {
                                    Alerta.TratamentoErroComLinha("Index.cshtml", "loadListaContratos.success", error);
                                }
                            },
                            error: function (err) {
                                Alerta.TratamentoErroComLinha("Index.cshtml", "loadListaContratos.error", err);
                            }
                        });
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "loadListaContratos", error);
                    }
                }

                function loadListaAtas(status) {
                    try {
                        $.ajax({
                            type: "get",
                            url: "/api/AtaRegistroPrecos/ListaAtas",
                            data: { id: status },
                            success: function (res) {
                                try {
                                    let option = '<option>-- Selecione uma Ata --</option>';
                                    if (res && res.data && res.data.length) {
                                        res.data.forEach(function (obj) {
                                            option += `<option value="${obj.value}">${obj.text}</option>`;
                                        });
                                    }
                                    $('#ListaAtas').empty().append(option);
                                } catch (error) {
                                    Alerta.TratamentoErroComLinha("Index.cshtml", "loadListaAtas.success", error);
                                }
                            },
                            error: function (err) {
                                Alerta.TratamentoErroComLinha("Index.cshtml", "loadListaAtas.error", err);
                            }
                        });
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "loadListaAtas", error);
                    }
                }

                $("#ListaContratos").on('change', function () {
                    try {
                        const id = $(this).val();
                        if ($.fn.DataTable.isDataTable('#tblEmpenho')) {
                            $('#tblEmpenho').DataTable().destroy();
                        }
                        PreencheTabelaEmpenho(id, "contrato");
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "ListaContratos.change", error);
                    }
                });

                $("#ListaAtas").on('change', function () {
                    try {
                        const id = $(this).val();
                        if ($.fn.DataTable.isDataTable('#tblEmpenho')) {
                            $('#tblEmpenho').DataTable().destroy();
                        }
                        PreencheTabelaEmpenho(id, "ata");
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "ListaAtas.change", error);
                    }
                });

                function PreencheTabelaEmpenho(id, instrumento) {
                    try {
                        $('#divEmpenho').show();

                        $('#tblEmpenho').DataTable({
                            columnDefs: [
                                { targets: 0, className: "text-center", width: "5%" },
                                { targets: 1, className: "text-center", width: "5%" },
                                { targets: 2, className: "text-center", width: "5%" },
                                { targets: 3, className: "text-right",  width: "8%" },
                                { targets: 4, className: "text-right",  width: "8%" },
                                { targets: 5, className: "text-right",  width: "8%" },
                                { targets: 6, className: "text-right",  width: "8%" },
                                { targets: 7, className: "text-center", width: "10%" },
                                { targets: 8, className: "text-center", width: "10%" },
                                { targets: 9, className: "text-center", visible: false }
                            ],
                            responsive: true,
                            ajax: {
                                url: "/api/empenho",
                                type: "GET",
                                datatype: "json",
                                data: { id: id, instrumento: instrumento }
                            },
                            columns: [
                                { data: "notaEmpenho" },
                                { data: "vigenciaInicialFormatada" },
                                { data: "vigenciaFinalFormatada" },
                                { data: "saldoInicialFormatado" },
                                { data: "saldoMovimentacaoFormatado" },
                                { data: "saldoNFFormatado" },
                                { data: "saldoFinalFormatado" },
                                {
                                    data: "empenhoId",
                                    render: function (data) {
                                        return `
                                            <div class="text-center">
                                                <a href="/Empenho/Upsert?id=${data}" class="btn btn-azul text-white" data-ejtip="Editar o Empenho" style="cursor:pointer; padding: 2px 6px !important; font-size: 12px !important; margin: 1px !important;">
                                                    <i class="far fa-edit"></i>
                                                </a>
                                                <a class="btn btn-delete btn-vinho text-white" data-ejtip="Excluir o Empenho" style="cursor:pointer; padding: 2px 6px !important; font-size: 12px !important; margin: 1px !important;" data-id='${data}'>
                                                    <i class="far fa-trash-alt"></i>
                                                </a>
                                                <a class="btn btn-documentos btn-info text-white" data-toggle="modal" data-target="#modalNF" id="rowdata" data-ejtip="Notas do Empenho" style="cursor:pointer; padding: 2px 6px !important; font-size: 12px !important; margin: 1px !important;" data-id='${data}'>
                                                    <i class="fal fa-file-pdf"></i>
                                                </a>
                                            </div>`;
                                    }
                                },
                                {
                                    data: "empenhoId",
                                    render: function (data) {
                                        return `
                                            <div class="text-center">
                                                <a class="btn btn-aporte btn-dark text-white" data-toggle="modal" data-target="#modalAporte" id="rowdata" data-ejtip="Aporte ao Empenho" style="cursor:pointer; padding: 2px 6px !important; font-size: 12px !important; margin: 1px !important;" data-id='${data}' data-backdrop="false">
                                                    <i class="fal fa-plus-circle"></i>
                                                </a>
                                                <a class="btn btn-anulacao btn-vinho text-white" data-toggle="modal" data-target="#modalAnulacao" id="rowdata" data-ejtip="Anulação do Empenho" style="cursor:pointer; padding: 2px 6px !important; font-size: 12px !important; margin: 1px !important;" data-id='${data}' data-backdrop="false">
                                                    <i class="fal fa-minus-circle"></i>
                                                </a>
                                            </div>`;
                                    }
                                },
                                { data: "empenhoId" }
                            ],
                            language: {
                                url: "https://cdn.datatables.net/plug-ins/1.10.25/i18n/Portuguese-Brasil.json",
                                emptyTable: "Sem Dados para Exibição"
                            },
                            width: "100%"
                        });
                    } catch (error) {
                        Alerta.TratamentoErroComLinha("Index.cshtml", "PreencheTabelaEmpenho", error);
                    }
                }

            } catch (error) {
                Alerta.TratamentoErroComLinha("Index.cshtml", "document.ready", error);
            }
        });
    </script>

    <script>
        function moeda(a, e, r, t) {
            try {
                let n = "", h = j = 0, u = tamanho2 = 0, l = ajd2 = "",
                    o = window.Event ? t.which : t.keyCode;
                if (o == 13 || o == 8) return !0;
                n = String.fromCharCode(o);
                if ("0123456789".indexOf(n) == -1) return !1;
                for (u = a.value.length, h = 0; h < u && ("0" == a.value.charAt(h) || a.value.charAt(h) == r); h++);
                for (l = ""; h < u; h++) "0123456789".indexOf(a.value.charAt(h)) != -1 && (l += a.value.charAt(h));
                if (l += n, (u = l.length) == 0) a.value = "";
                if (u == 1) a.value = "0" + r + "0" + l;
                if (u == 2) a.value = "0" + r + l;
                if (u > 2) {
                    for (ajd2 = "", j = 0, h = u - 3; h >= 0; h--) 3 == j && (ajd2 += e, j = 0), ajd2 += l.charAt(h), j++;
                    for (a.value = "", tamanho2 = ajd2.length, h = tamanho2 - 1; h >= 0; h--) a.value += ajd2.charAt(h);
                    a.value += r + l.substr(u - 2, u)
                }
                return !1;
            } catch (error) {
                Alerta.TratamentoErroComLinha("Index.cshtml", "moeda", error);
            }
        }
    </script>
}
