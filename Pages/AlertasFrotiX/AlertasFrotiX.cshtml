@page
@model FrotiX.Pages.AlertasFrotiX.IndexModel
@{
	ViewData["Title"] = "Gestão de Alertas";
	ViewData["PageName"] = "alertasfrotix_alertasfrotix";
	ViewData["Heading"] = "<i class='fa-duotone fa-bell'></i> Sistema: <span class='fw-300'>Alertas</span>";
	ViewData["Category1"] = "Alertas";
	ViewData["PageIcon"] = "fa-duotone fa-bell";
}

@section HeadBlock {
	<style>
		/* Botão azul */
		.btn-azul {
			background-color: #0ea5e9;
			color: white;
			border: none;
			transition: all 0.3s ease;
		}

			.btn-azul:hover {
				background-color: #0284c7;
				transform: translateY(-2px);
				box-shadow: 0 4px 8px rgba(0,0,0,0.2);
			}

		/* Título da página */
		.titulo-pagina {
			color: #325d88;
			font-weight: 600;
		}

		/* Badges de tipo */
		.badge-tipo {
			font-size: 0.75rem;
			padding: 0.25rem 0.5rem;
			border-radius: 0.25rem;
			font-weight: 500;
		}

		.badge-agendamento {
			background-color: #0ea5e9;
			color: white;
		}

		.badge-manutencao {
			background-color: #f59e0b;
			color: white;
		}

		.badge-motorista {
			background-color: #14b8a6;
			color: white;
		}

		.badge-veiculo {
			background-color: #7c3aed;
			color: white;
		}

		.badge-anuncio {
			background-color: #dc2626;
			color: white;
		}

		.badge-diversos {
			background-color: #6c757d;
			color: white;
		}

		/* Prioridades */
		.prioridade-baixa {
			color: #10b981;
		}

		.prioridade-media {
			color: #f59e0b;
		}

		.prioridade-alta {
			color: #ef4444;
		}

		/* TABS CUSTOMIZADO - SEM DEPENDÊNCIA DE BOOTSTRAP JS */
		.nav-tabs-custom {
			border-bottom: 2px solid #e5e7eb;
			margin-bottom: 1.5rem;
		}

		.nav-tabs-custom .nav-link {
			color: #6b7280;
			border: none;
			padding: 0.75rem 1.5rem;
			font-weight: 500;
			transition: all 0.3s ease;
			border-bottom: 3px solid transparent;
			background: transparent;
			cursor: pointer;
		}

		.nav-tabs-custom .nav-link:hover {
			color: #0284c7;
			border-color: transparent;
			background: transparent;
		}

		.nav-tabs-custom .nav-link.active {
			color: #0ea5e9;
			border-bottom: 3px solid #0ea5e9;
			background: transparent;
		}

		/* Badges nas abas - COMPACTO */
		.nav-tabs-custom .badge {
			font-size: 0.7rem;
			padding: 0.15rem 0.4rem;
			margin-left: 0.5rem;
		}

		/* Tab panes */
		.tab-pane {
			display: none;
		}

		.tab-pane.active {
			display: block;
		}

		/* DataTable - COMPACTO */
		#tblAlertasLidos_wrapper .dataTables_filter input,
		#tblAlertasInativos_wrapper .dataTables_filter input,
		#tblMeusAlertas_wrapper .dataTables_filter input {
			border-radius: 0.25rem;
			border: 1px solid #d1d5db;
			padding: 0.375rem 0.75rem;
		}

		#tblAlertasLidos td, #tblAlertasLidos th,
		#tblAlertasInativos td, #tblAlertasInativos th,
		#tblMeusAlertas td, #tblMeusAlertas th {
			padding: 0.5rem;
			vertical-align: middle;
		}

		/* Borda colorida nos cards */
		.border-left-4 {
			border-left: 4px solid;
		}

		/* Timeline */
		.timeline-vertical {
			position: relative;
			padding-left: 40px;
		}

			.timeline-vertical::before {
				content: '';
				position: absolute;
				left: 15px;
				top: 0;
				bottom: 0;
				width: 2px;
				background: #dee2e6;
			}

		.timeline-item {
			position: relative;
			padding-bottom: 20px;
		}

			.timeline-item::before {
				content: '';
				position: absolute;
				left: -29px;
				top: 5px;
				width: 12px;
				height: 12px;
				border-radius: 50%;
				background: #fff;
				border: 2px solid #007bff;
			}

			.timeline-item.lido::before {
				background: #28a745;
				border-color: #28a745;
			}

			.timeline-item.nao-lido::before {
				background: #ffc107;
				border-color: #ffc107;
			}

			.timeline-item.apagado::before {
				background: #dc3545;
				border-color: #dc3545;
			}

		/* Cards */
		.card {
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}

			.card:hover {
				transform: translateY(-2px);
				box-shadow: 0 8px 16px rgba(0,0,0,0.2) !important;
			}

		/* Progress bar */
		.progress-bar {
			transition: width 1s ease, background 0.3s ease;
		}

			.progress-bar.bg-danger {
				background: linear-gradient(90deg, #dc3545 0%, #c82333 100%);
			}

			.progress-bar.bg-warning {
				background: linear-gradient(90deg, #ffc107 0%, #e0a800 100%);
			}

			.progress-bar.bg-success {
				background: linear-gradient(90deg, #28a745 0%, #218838 100%);
			}

		/* Progress bar no modal - FINO */
		#progressoLeitura {
			height: 20px !important;
			line-height: 20px !important;
			font-size: 12px !important;
		}

		/* Remover card roxo do modal */
		.modal-body .card {
			background: none !important;
			box-shadow: none !important;
			border: none !important;
		}

		.modal-body .card-body {
			padding: 0 !important;
		}

		.modal-body .progress {
			height: 20px !important;
			background-color: #e9ecef !important;
		}

		/* Botão cor vinho */
		.btn-vinho-wine {
			background-color: #722f37 !important;
			border-color: #5a252c !important;
			color: white !important;
		}

			.btn-vinho-wine:hover {
				background-color: #5a252c !important;
				border-color: #4a1f24 !important;
				transform: translateY(-2px);
				box-shadow: 0 4px 8px rgba(114, 47, 55, 0.3);
			}

			.btn-vinho-wine:active,
			.btn-vinho-wine:focus {
				background-color: #4a1f24 !important;
				border-color: #3a1820 !important;
				box-shadow: 0 0 0 0.2rem rgba(114, 47, 55, 0.25);
			}

		/* Melhorar visual do botão fechar */
		#modalDetalhesAlerta .btn-secondary {
			background-color: #6c757d;
			border-color: #6c757d;
		}

			#modalDetalhesAlerta .btn-secondary:hover {
				background-color: #5a6268;
				border-color: #545b62;
				transform: translateY(-2px);
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
			}
	</style>
}

<div class="row">
	<div class="col-xl-12">
		<div id="panel-1" class="panel">
			<div class="panel-container show pt-4">
				<!-- Container para título e botão -->
				<div class="d-flex justify-content-between align-items-center px-3 mb-3">
					<h2 class="titulo-paginas mb-0">
						<i class="fa-duotone fa-bell"></i>
						Gestão de Alertas
					</h2>
					<a href="./AlertasFrotiX/Upsert" class="btn btn-azul form-control" data-ejtip="Criar Novo Alerta" style="max-width: 200px;">
						<i class="fa-duotone fa-file-plus icon-space icon-pulse"></i>
						&nbsp; Novo Alerta
					</a>
				</div>

				<!-- Linha divisória -->
				<div class="col-12" style="border-bottom:1px solid #325d88"></div>

				<!-- Campo oculto com ID do usuário atual -->
				<input type="hidden" id="usuarioAtualId" value="@User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value" />

				<!-- TABS MANUAIS - SEM BOOTSTRAP JS -->
				<div class="px-3 mt-3">
					<!-- Nav tabs -->
					<ul class="nav nav-tabs nav-tabs-custom" id="alertasTabs" role="tablist">
						<li class="nav-item" role="presentation">
							<a class="nav-link active" 
							   href="#tabInativos" 
							   data-tab="tabInativos"
							   data-ejtip="Alertas que já foram finalizados">
								<i class="fa-duotone fa-history me-2"></i>
								Alertas Inativos
								<span class="badge bg-secondary" id="badgeInativos">0</span>
							</a>
						</li>
						<li class="nav-item" role="presentation">
							<a class="nav-link" 
							   href="#tabAtivos" 
							   data-tab="tabAtivos"
							   data-ejtip="Alertas atualmente ativos no sistema">
								<i class="fa-duotone fa-bell-on me-2"></i>
								Alertas Ativos
								<span class="badge bg-danger" id="badgeAtivos">0</span>
							</a>
						</li>
						<li class="nav-item" role="presentation">
							<a class="nav-link" 
							   href="#tabMeusAlertas" 
							   data-tab="tabMeusAlertas"
							   data-ejtip="Alertas que você recebeu">
								<i class="fa-duotone fa-user-circle me-2"></i>
								Meus Alertas
								<span class="badge bg-primary" id="badgeMeusAlertas">0</span>
							</a>
						</li>
					</ul>

					<!-- Tab panes -->
					<div class="tab-content" id="alertasTabsContent">
						<!-- Tab Alertas Inativos -->
						<div class="tab-pane active" id="tabInativos" role="tabpanel">
							<div class="panel-content pt-3">
								<div class="box-body">
									<table id="tblAlertasInativos" class="table table-bordered table-striped" width="100%">
										<thead>
											<tr>
												<th width="3%">Ícone</th>
												<th width="17%">Título</th>
												<th width="37%">Descrição</th>
												<th width="7%">Tipo</th>
												<th width="7%">Prioridade</th>
												<th width="8%">Data Inserção</th>
												<th width="8%">Data Baixa</th>
												<th width="8%">% Leitura</th>
												<th width="5%">Ações</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>
							</div>
						</div>

						<!-- Tab Alertas Ativos -->
						<div class="tab-pane" id="tabAtivos" role="tabpanel">
							<div class="panel-content pt-3">
								<div class="box-body">
									<div id="alertasAtivosContainer" class="row">
										<!-- Cards de alertas ativos serão inseridos aqui via JavaScript -->
									</div>
								</div>
							</div>
						</div>

						<!-- Tab Meus Alertas -->
						<div class="tab-pane" id="tabMeusAlertas" role="tabpanel">
							<div class="panel-content pt-3">
								<div class="box-body">
									<table id="tblMeusAlertas" class="table table-bordered table-striped" width="100%">
										<thead>
											<tr>
												<th width="3%">Ícone</th>
												<th width="15%">Título</th>
												<th width="30%">Descrição</th>
												<th width="8%">Tipo</th>
												<th width="8%">Notificado</th>
												<th width="10%">Notificado Em</th>
												<th width="8%">Lido</th>
												<th width="10%">Lido Em</th>
												<th width="8%">Ações</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Modal Detalhes do Alerta -->
<div class="modal fade" id="modalDetalhesAlerta" tabindex="-1" role="dialog" aria-labelledby="modalDetalhesAlertaLabel" aria-hidden="true">
	<div class="modal-dialog modal-xl" role="document">
		<div class="modal-content">
			<!-- Header -->
			<div class="modal-header modal-header-terracota" id="alertaCabecalho">
				<div class="d-flex align-items-center w-100">
					<i class="fa-duotone fa-bell fa-3x text-primary mr-3" id="iconeAlerta"></i>
					<div class="flex-grow-1">
						<h5 class="modal-title mb-1" id="tituloAlerta">Carregando...</h5>
						<div>
							<span class="badge badge-primary mr-2" id="badgeTipo">Tipo</span>
							<span class="badge badge-danger mr-2" id="badgePrioridade">Prioridade</span>
							<span id="badgeStatus"></span>
						</div>
					</div>
				</div>
				<button type="button" class="close" data-dismiss="modal" aria-label="Fechar" data-ejtip="Fechar Modal">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<!-- Body -->
			<div class="modal-body">
				<!-- Loader -->
				<div id="loaderDetalhes" class="text-center py-5">
					<i class="fa-duotone fa-spinner fa-spin fa-3x text-primary mb-3"></i>
					<p>Carregando detalhes do alerta...</p>
				</div>

				<!-- Conteúdo Principal -->
				<div id="conteudoDetalhes" style="display: none;">
					<!-- Descrição -->
					<div class="card mb-3">
						<div class="card-header bg-light">
							<i class="fa-duotone fa-info-circle"></i> Descrição
						</div>
						<div class="card-body">
							<p id="descricaoAlerta" class="mb-0"></p>
						</div>
					</div>

					<!-- Informações Gerais -->
					<div class="row mb-3">
						<div class="col-md-6">
							<div class="card h-100">
								<div class="card-header bg-light">
									<i class="fa-duotone fa-calendar-alt"></i> Informações Gerais
								</div>
								<div class="card-body">
									<p><strong>Data de Criação:</strong> <span id="dataCriacao"></span></p>
									<p><strong>Data de Exibição:</strong> <span id="dataExibicao"></span></p>
									<p><strong>Criado Por:</strong> <span id="criadoPor"></span></p>
									<p class="mb-0"><strong>Tempo no Ar:</strong> <span id="tempoNoAr"></span></p>
								</div>
							</div>
						</div>

						<div class="col-md-6">
							<div class="card h-100">
								<div class="card-header bg-light">
									<i class="fa-duotone fa-chart-bar"></i> Resumo das Estatísticas
								</div>
								<div class="card-body">
									<div class="row">
										<div class="col-6">
											<p class="mb-2">
												<i class="fa-duotone fa-users text-primary"></i>
												<strong>Destinatários:</strong> <span id="totalDestinatariosResumo">0</span>
											</p>
											<p class="mb-2">
												<i class="fa-duotone fa-bell text-info"></i>
												<strong>Notificados:</strong> <span id="totalNotificadosResumo">0</span>
											</p>
											<p class="mb-0">
												<i class="fa-duotone fa-clock text-warning"></i>
												<strong>Aguardando:</strong> <span id="aguardandoNotificacaoResumo">0</span>
											</p>
										</div>
										<div class="col-6">
											<p class="mb-2">
												<i class="fa-duotone fa-check-circle text-success"></i>
												<strong>Leram:</strong> <span id="usuariosLeramResumo">0</span>
											</p>
											<p class="mb-2">
												<i class="fa-duotone fa-times-circle text-danger"></i>
												<strong>Não Leram:</strong> <span id="usuariosNaoLeramResumo">0</span>
											</p>
											<p class="mb-0">
												<i class="fa-duotone fa-trash text-secondary"></i>
												<strong>Apagaram:</strong> <span id="usuariosApagaramResumo">0</span>
											</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Estatísticas Detalhadas - 6 Cards -->
					<div class="mb-4">
						<h6 class="fw-bold mb-3">
							<i class="fa-duotone fa-chart-line"></i> Estatísticas Detalhadas
						</h6>
						<div class="row g-3">
							<!-- Total Destinatários -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-primary shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-users fa-2x text-primary mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">Total Destinatários</h6>
										<h3 class="card-title mb-0" id="totalDestinatarios">0</h3>
									</div>
								</div>
							</div>

							<!-- Total Notificados -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-info shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-bell fa-2x text-info mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">Já Notificados</h6>
										<h3 class="card-title mb-0" id="totalNotificados">0</h3>
									</div>
								</div>
							</div>

							<!-- Aguardando Notificação -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-warning shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-clock fa-2x text-warning mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">Aguardando</h6>
										<h3 class="card-title mb-0" id="aguardandoNotificacao">0</h3>
									</div>
								</div>
							</div>

							<!-- Leram -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-success shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-check-circle fa-2x text-success mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">Leram</h6>
										<h3 class="card-title mb-0" id="usuariosLeram">0</h3>
									</div>
								</div>
							</div>

							<!-- Não Leram -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-danger shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-times-circle fa-2x text-danger mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">Não Leram</h6>
										<h3 class="card-title mb-0" id="usuariosNaoLeram">0</h3>
									</div>
								</div>
							</div>

							<!-- Apagaram -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-secondary shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-trash fa-2x text-secondary mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">Apagaram</h6>
										<h3 class="card-title mb-0" id="usuariosApagaram">0</h3>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Progresso de Leitura -->
					<div class="card mb-3">
						<div class="card-header bg-light">
							<i class="fa-duotone fa-chart-line"></i> Progresso de Leitura
						</div>
						<div class="card-body">
							<div class="mb-2">
								<small class="text-muted" id="infoLeitores">Carregando...</small>
							</div>
							<div class="progress" style="height: 30px;">
								<div class="progress-bar progress-bar-striped progress-bar-animated"
									 id="progressoLeitura"
									 role="progressbar"
									 aria-valuenow="0"
									 aria-valuemin="0"
									 aria-valuemax="100"
									 style="width: 0%;">
									<span id="textoProgressoBarra">0%</span>
								</div>
							</div>
						</div>
					</div>

					<!-- Links Relacionados (se houver) -->
					<div class="card mb-3" id="linksRelacionados" style="display: none;">
						<div class="card-header bg-light">
							<i class="fa-duotone fa-link"></i> Links Relacionados
						</div>
						<div class="card-body" id="conteudoLinks">
							<!-- Links serão inseridos aqui via JS -->
						</div>
					</div>

					<!-- Tabela de Usuários que Receberam o Alerta -->
					<div class="card">
						<div class="card-header bg-light d-flex justify-content-between align-items-center">
							<span>
								<i class="fa-duotone fa-users"></i>
								Usuários que Receberam o Alerta
							</span>
							<button class="btn btn-sm btn-verde" id="btnExportarDetalhes" style="display: none;" data-ejtip="Exportar para Excel">
								<i class="fa-duotone fa-file-excel"></i> Exportar Excel
							</button>
						</div>
						<div class="card-body p-0">
							<div class="table-responsive">
								<table class="table table-striped table-sm table-hover mb-0">
									<thead class="table-dark">
										<tr>
											<th>Usuário</th>
											<th class="text-center">Notificado</th>
											<th class="text-center">Status Leitura</th>
											<th class="text-center">Data Notificação</th>
											<th class="text-center">Data Leitura</th>
											<th class="text-center">Tempo até Leitura</th>
										</tr>
									</thead>
									<tbody id="tabelaUsuarios">
										<tr>
											<td colspan="6" class="text-center py-4">
												<div class="spinner-border spinner-border-sm text-primary" role="status">
													<span class="visually-hidden">Carregando...</span>
												</div>
												<span class="ms-2 text-muted">Carregando usuários...</span>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Footer com botões -->
			<div class="modal-footer d-flex justify-content-between">
				<!-- Botão Baixa no Alerta - Esquerda -->
				<button type="button"
						class="btn btn-azul form-control"
						id="btnBaixaAlerta"
						style="max-width: 250px;"
						data-ejtip="Finalizar este alerta">
					<i class="fa-duotone fa-file-plus icon-space icon-pulse"></i>
					Dar Baixa no Alerta
				</button>

				<!-- Botões Direita -->
				<div>
					<button type="button"
							class="btn btn-vinho form-control"
							data-dismiss="modal"
							data-ejtip="Fechar Modal"
							style="max-width: 150px;">
						<i class="fa-solid fa-rotate-left icon-space icon-rotate-left"></i>
						Fechar
					</button>
				</div>
			</div>
		</div>
	</div>
</div>

@section ScriptsBlock {
	<script src="~/lib/microsoft-signalr/signalr.min.js" asp-append-version="true"></script>
	<script src="~/js/alertas/alertas_gestao.js" asp-append-version="true"></script>

	<script>
		// SISTEMA DE TABS MANUAL - SEM DEPENDÊNCIA DE BOOTSTRAP JS
		(function() {
			'use strict';

			// Controle de tabs já visitadas (para inicializar DataTables sob demanda)
			var tabsVisitadas = {
				tabInativos: false,
				tabAtivos: false,
				tabMeusAlertas: false
			};

			// Função para trocar tabs
			function switchTab(tabId) {
				try {
					console.log('Trocando para tab:', tabId);

					// Remover active de todos os links
					document.querySelectorAll('.nav-tabs-custom .nav-link').forEach(function(link) {
						link.classList.remove('active');
					});

					// Esconder todos os tab-panes
					document.querySelectorAll('.tab-pane').forEach(function(pane) {
						pane.classList.remove('active');
					});

					// Ativar o link clicado
					var clickedLink = document.querySelector('.nav-link[data-tab="' + tabId + '"]');
					if (clickedLink) {
						clickedLink.classList.add('active');
					}

					// Mostrar o tab-pane correspondente
					var targetPane = document.getElementById(tabId);
					if (targetPane) {
						targetPane.classList.add('active');
					}

					// NÃO recarregar DataTables automaticamente para evitar erro "abort"
					// Apenas carregar alertas ativos quando necessário
					console.log('Tab ativada:', tabId);
					
					if (tabId === 'tabAtivos') {
						// Só os alertas ativos precisam recarregar
						if (typeof carregarAlertasGestao === 'function') {
							console.log('Carregando alertas ativos...');
							setTimeout(function() {
								carregarAlertasGestao();
							}, 150);
						}
					}
					
					// Marcar tab como visitada
					if (tabsVisitadas.hasOwnProperty(tabId)) {
						if (!tabsVisitadas[tabId]) {
							console.log('Primeira visita à tab:', tabId);
							tabsVisitadas[tabId] = true;
						}
					}
					
					// DataTables NÃO serão recarregadas automaticamente
					// Elas já carregam na inicialização e o usuário pode usar os controles da tabela
					// Isso evita o erro "abort" completamente
				} catch (error) {
					console.error('Erro ao trocar tab:', error);
					if (typeof Alerta !== 'undefined' && typeof Alerta.TratamentoErroComLinha === 'function') {
						Alerta.TratamentoErroComLinha("AlertasFrotiX.cshtml", "switchTab", error);
					}
				}
			}

			// Inicializar tabs quando o DOM estiver pronto
			function initTabs() {
				try {
					console.log('Inicializando sistema de tabs manual...');

					// Marcar primeira tab como visitada
					tabsVisitadas.tabInativos = true;

					// Adicionar event listeners nos links
					document.querySelectorAll('.nav-tabs-custom .nav-link').forEach(function(link) {
						link.addEventListener('click', function(e) {
							e.preventDefault();
							var tabId = this.getAttribute('data-tab');
							if (tabId) {
								switchTab(tabId);
							}
						});
					});

					console.log('✅ Sistema de tabs manual inicializado!');
					console.log('✅ Event listeners adicionados a', document.querySelectorAll('.nav-tabs-custom .nav-link').length, 'tabs');
				} catch (error) {
					console.error('Erro ao inicializar tabs:', error);
					if (typeof Alerta !== 'undefined' && typeof Alerta.TratamentoErroComLinha === 'function') {
						Alerta.TratamentoErroComLinha("AlertasFrotiX.cshtml", "initTabs", error);
					}
				}
			}

			// Executar quando o DOM estiver pronto
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', initTabs);
			} else {
				initTabs();
			}

			// Também executar quando a página carregar completamente (fallback)
			window.addEventListener('load', function() {
				// Verificar se já foi inicializado
				var initialized = document.querySelector('.nav-tabs-custom .nav-link[data-initialized]');
				if (!initialized) {
					initTabs();
				}
			});
		})();
	</script>
}
