@page
@addTagHelper*, Microsoft.AspNetCore.Mvc.TagHelpers

@model FrotiX.Pages.Encarregado.UpsertModel

@{
    ViewData["Title"]     = "Encarregados";
    ViewData["PageName"]  = "encarregado_upsert";
    ViewData["Heading"]   = "<i class='fa-duotone fa-user-tie'></i> Cadastros: <span class='fw-300'>Encarregados</span>";
    ViewData["Category1"] = "Cadastros";
    ViewData["PageIcon"]  = "fa-duotone fa-user-tie";
    
    var isEdicao = Model.EncarregadoObj.Encarregado.EncarregadoId != Guid.Empty;
}

@section HeadBlock {
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* ====== HEADER: herda do frotix.css global, apenas ajustes locais ====== */

        /* Ajuste do botão laranja no header */
        .ftx-card-header .btn-fundo-laranja {
            border: 2px solid rgba(255, 255, 255, 0.7) !important;
            outline: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* ====== PANEL CONTENT ====== */
        .panel-content {
            padding: 1.25rem;
            background: #f8f9fa;
        }

        /* ====== CARD LEVE ====== */
        .ftx-card {
            background: #fff;
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
            overflow: hidden;
        }

        .ftx-card-title {
            background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
            padding: 0.6rem 1rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ftx-card-title i {
            --fa-primary-color: #3D5771;
            --fa-secondary-color: #6b8ba3;
            --fa-secondary-opacity: 0.7;
            font-size: 0.95rem;
        }

        .ftx-card-title span {
            font-family: 'Outfit', sans-serif !important;
            font-weight: 600 !important;
            font-size: 0.85rem;
            color: #3D5771;
        }

        .ftx-card-body {
            padding: 1rem;
        }

        /* ====== CAMPOS DO FORMULÁRIO ====== */
        .ftx-form-group {
            margin-bottom: 0.75rem;
        }

        .ftx-form-group label {
            font-weight: 600;
            font-size: 0.8rem;
            color: #495057;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .ftx-form-group label i {
            --fa-primary-color: #6c757d;
            --fa-secondary-color: #adb5bd;
            font-size: 0.85rem;
        }

        .ftx-form-group .form-control {
            min-height: 2.2rem;
            padding: 0.4rem 0.65rem;
            font-size: 0.875rem;
            border-radius: 4px;
            border: 1px solid #ced4da;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .ftx-form-group .form-control:focus {
            border-color: #3D5771;
            box-shadow: 0 0 0 3px rgba(61, 87, 113, 0.15);
        }

        .ftx-form-group .form-select {
            min-height: 2.2rem;
            padding: 0.4rem 0.65rem;
            font-size: 0.875rem;
        }

        .text-danger {
            font-size: 0.75rem;
        }

        /* ====== CHECKBOX ESTILIZADO ====== */
        .ftx-check-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .ftx-check-card:hover {
            border-color: #3D5771;
            background: #fff;
        }

        .ftx-check-card .form-check-input {
            width: 1.2rem;
            height: 1.2rem;
            margin: 0;
            cursor: pointer;
        }

        .ftx-check-card .form-check-input:checked {
            background-color: #22c55e;
            border-color: #22c55e;
        }

        .ftx-check-card label {
            font-weight: 500;
            font-size: 0.85rem;
            color: #495057;
            cursor: pointer;
            margin: 0;
        }

        /* ====== SEÇÃO DE FOTO ====== */
        .ftx-foto-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .ftx-foto-container {
            width: 200px;
            height: 200px;
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid #3D5771;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .ftx-foto-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ftx-foto-upload {
            width: 100%;
        }

        .ftx-foto-upload .form-control {
            font-size: 0.8rem;
            padding: 0.35rem 0.5rem;
        }

        /* ====== INFO DE ALTERAÇÃO ====== */
        .ftx-info-alteracao {
            background: linear-gradient(135deg, #e3f2fd 0%, #f5f5f5 100%);
            border-left: 3px solid #3D5771;
            padding: 0.6rem 1rem;
            font-size: 0.8rem;
            color: #495057;
            border-radius: 0 6px 6px 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ftx-info-alteracao i {
            --fa-primary-color: #3D5771;
            --fa-secondary-color: #6b8ba3;
        }

        /* ====== BOTÕES DO FORMULÁRIO ====== */
        .ftx-btn-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            padding-top: 0.5rem; /* Espaço para animação wiggle dos botões */
        }

        .ftx-btn-group .btn {
            padding: 0.5rem 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }

        .ftx-btn-group .btn:hover {
            transform: translateY(-1px);
        }

        /* ====== RESPONSIVO ====== */
        @@media (max-width: 992px) {
            .col-lg-4 {
                order: -1;
                margin-bottom: 1rem;
            }

            .ftx-foto-container {
                width: 150px;
                height: 150px;
            }
        }

        @@media (max-width: 768px) {
            .ftx-card-header {
                flex-direction: column;
                text-align: center;
            }

            .ftx-card-header .titulo-paginas {
                font-size: 1.2rem;
            }

            .ftx-btn-group {
                justify-content: center;
            }
        }
    </style>
}

<form method="post" enctype="multipart/form-data">
    <div class="row">
        <div class="col-xl-12">
            <div id="panel-1" class="panel">
                <div class="panel-container show">

                    <!-- HEADER AZUL PADRÃO FROTIX -->
                    <div class="ftx-card-header">
                        <h2 class="titulo-paginas">
                            <i class="fa-duotone fa-user-helmet-safety"></i>
                            @(isEdicao ? "Editar Encarregado" : "Novo Encarregado")
                        </h2>
                        <a href="/Encarregado" class="btn btn-fundo-laranja" data-ftx-loading>
                            <i class="fa-duotone fa-rotate-left icon-space icon-rotate-left"></i>
                            Voltar à Lista
                        </a>
                    </div>

                    <!-- CONTEÚDO -->
                    <div class="panel-content">
                        <div class="row">

                            <!-- COLUNA PRINCIPAL (FORMULÁRIO) -->
                            <div class="col-lg-8">

                                <!-- DADOS PESSOAIS -->
                                <div class="ftx-card">
                                    <div class="ftx-card-title">
                                        <i class="fa-duotone fa-user"></i>
                                        <span>Dados Pessoais</span>
                                    </div>
                                    <div class="ftx-card-body">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="ftx-form-group">
                                                    <label>
                                                        <i class="fa-duotone fa-user"></i>
                                                        Nome Completo
                                                    </label>
                                                    <input class="form-control" asp-for="EncarregadoObj.Encarregado.Nome" placeholder="Digite o nome completo" onblur="toCamelCase(this)" />
                                                    <span class="text-danger" asp-validation-for="EncarregadoObj.Encarregado.Nome"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="ftx-form-group">
                                                    <label>
                                                        <i class="fa-duotone fa-hashtag"></i>
                                                        Ponto
                                                    </label>
                                                    <input class="form-control" asp-for="EncarregadoObj.Encarregado.Ponto" placeholder="Ex: 12345" onblur="normalizaPonto(this)" />
                                                    <span class="text-danger" asp-validation-for="EncarregadoObj.Encarregado.Ponto"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="ftx-form-group">
                                                    <label>
                                                        <i class="fa-duotone fa-id-card"></i>
                                                        CPF
                                                    </label>
                                                    <input class="form-control" asp-for="EncarregadoObj.Encarregado.CPF" onkeyup="mascara(this)" onblur="validaCPF(this)" maxlength="14" placeholder="000.000.000-00" />
                                                    <span class="text-danger" asp-validation-for="EncarregadoObj.Encarregado.CPF"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="ftx-form-group">
                                                    <label>
                                                        <i class="fa-duotone fa-cake-candles"></i>
                                                        Data de Nascimento
                                                    </label>
                                                    <input class="form-control" asp-for="EncarregadoObj.Encarregado.DataNascimento" type="date" onblur="validaData(this, 'Data de Nascimento')" />
                                                    <span class="text-danger" asp-validation-for="EncarregadoObj.Encarregado.DataNascimento"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- CONTATO -->
                                <div class="ftx-card">
                                    <div class="ftx-card-title">
                                        <i class="fa-duotone fa-phone"></i>
                                        <span>Contato</span>
                                    </div>
                                    <div class="ftx-card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="ftx-form-group">
                                                    <label>
                                                        <i class="fa-duotone fa-mobile"></i>
                                                        Celular Principal
                                                    </label>
                                                    <input class="form-control" asp-for="EncarregadoObj.Encarregado.Celular01" placeholder="(61) 99999-9999" onkeyup="mascaraTelefone(this)" onblur="mascaraTelefone(this)" maxlength="15" />
                                                    <span class="text-danger" asp-validation-for="EncarregadoObj.Encarregado.Celular01"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="ftx-form-group">
                                                    <label>
                                                        <i class="fa-duotone fa-mobile-screen"></i>
                                                        Celular Secundário
                                                    </label>
                                                    <input class="form-control" asp-for="EncarregadoObj.Encarregado.Celular02" placeholder="(61) 99999-9999" onkeyup="mascaraTelefone(this)" onblur="mascaraTelefone(this)" maxlength="15" />
                                                    <span class="text-danger" asp-validation-for="EncarregadoObj.Encarregado.Celular02"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- VÍNCULO -->
                                <div class="ftx-card">
                                    <div class="ftx-card-title">
                                        <i class="fa-duotone fa-file-contract"></i>
                                        <span>Vínculo Contratual</span>
                                    </div>
                                    <div class="ftx-card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="ftx-form-group">
                                                    <label>
                                                        <i class="fa-duotone fa-calendar-check"></i>
                                                        Data de Ingresso
                                                    </label>
                                                    <input class="form-control" asp-for="EncarregadoObj.Encarregado.DataIngresso" type="date" onblur="validaData(this, 'Data de Ingresso')" />
                                                    <span class="text-danger" asp-validation-for="EncarregadoObj.Encarregado.DataIngresso"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="ftx-form-group">
                                                    <label>
                                                        <i class="fa-duotone fa-file-contract"></i>
                                                        Contrato
                                                    </label>
                                                    @Html.DropDownListFor(
                                                        m => m.EncarregadoObj.Encarregado.ContratoId,
                                                        Model.EncarregadoObj.ContratoList,
                                                        "-- Selecione um Contrato --",
                                                        new { @class = "form-select" }
                                                    )
                                                    <span class="text-danger" asp-validation-for="EncarregadoObj.Encarregado.ContratoId"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row mt-2">
                                            <div class="col-md-4">
                                                <div class="ftx-check-card">
                                                    <input type="checkbox" 
                                                           class="form-check-input" 
                                                           asp-for="EncarregadoObj.Encarregado.Status" 
                                                           id="chkStatus" />
                                                    <label for="chkStatus">
                                                        Encarregado Ativo
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- INFO DE ALTERAÇÃO -->
                                @if (isEdicao)
                                {
                                    <div class="ftx-info-alteracao mb-3">
                                        <i class="fa-duotone fa-clock-rotate-left"></i>
                                        Alterado por <strong>@Model.EncarregadoObj.NomeUsuarioAlteracao</strong>
                                        em @Model.EncarregadoObj.Encarregado.DataAlteracao?.ToString("dd/MM/yyyy")
                                        às @Model.EncarregadoObj.Encarregado.DataAlteracao?.ToString("HH:mm")
                                    </div>
                                }

                                <!-- BOTÕES DE AÇÃO -->
                                <div class="ftx-btn-group">
                                    @if (isEdicao)
                                    {
                                        <button type="submit"
                                                asp-page-handler="Edit"
                                                asp-route-id="@Model.EncarregadoObj.Encarregado.EncarregadoId"
                                                class="btn btn-azul btn-submit-spin">
                                            <i class="fa-duotone fa-floppy-disk icon-space icon-pulse"></i>
                                            Atualizar Encarregado
                                        </button>
                                    }
                                    else
                                    {
                                        <button type="submit"
                                                asp-page-handler="Submit"
                                                class="btn btn-azul btn-submit-spin">
                                            <i class="fa-duotone fa-floppy-disk icon-space icon-pulse"></i>
                                            Criar Encarregado
                                        </button>
                                    }
                                    <a asp-page="./Index" class="btn btn-ftx-fechar" data-ftx-loading>
                                        <i class="fa-duotone fa-circle-xmark icon-space icon-pulse"></i>
                                        Cancelar Operação
                                    </a>
                                </div>

                            </div>

                            <!-- COLUNA LATERAL (FOTO) -->
                            <div class="col-lg-4">
                                <div class="ftx-card">
                                    <div class="ftx-card-title">
                                        <i class="fa-duotone fa-camera"></i>
                                        <span>Foto do Encarregado</span>
                                    </div>
                                    <div class="ftx-card-body">
                                        <div class="ftx-foto-section">
                                            <div class="ftx-foto-container">
                                                <img id="imgViewer" src="/Images/barbudo.jpg" alt="Foto do Encarregado" />
                                            </div>
                                            <div class="ftx-foto-upload">
                                                <input class="form-control" 
                                                       id="txtFile" 
                                                       type="file" 
                                                       accept="image/*" 
                                                       asp-for="FotoUpload" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</form>

@section ScriptsBlock {
    <script>
        // --------- Máscara CPF ---------
        function mascara(i) {
            try {
                var v = i.value || "";
                v = v.replace(/\D/g, "");

                if (v.length > 11) v = v.substring(0, 11);

                if (v.length > 9) {
                    v = v.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/, "$1.$2.$3-$4");
                } else if (v.length > 6) {
                    v = v.replace(/(\d{3})(\d{3})(\d{0,3})/, "$1.$2.$3");
                } else if (v.length > 3) {
                    v = v.replace(/(\d{3})(\d{0,3})/, "$1.$2");
                }

                i.value = v;
            } catch (error) {
                Alerta.TratamentoErroComLinha("Upsert.cshtml", "mascara", error);
            }
        }

        // --------- Máscara Telefone ---------
        function mascaraTelefone(i) {
            try {
                var v = i.value || "";
                v = v.replace(/\D/g, "");

                if (v.length > 11) v = v.substring(0, 11);

                if (v.length > 10) {
                    // Celular: (99) 99999-9999
                    v = v.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
                } else if (v.length > 6) {
                    // Fixo ou parcial: (99) 9999-9999
                    v = v.replace(/(\d{2})(\d{4})(\d{0,4})/, "($1) $2-$3");
                } else if (v.length > 2) {
                    v = v.replace(/(\d{2})(\d{0,5})/, "($1) $2");
                } else if (v.length > 0) {
                    v = v.replace(/(\d{0,2})/, "($1");
                }

                i.value = v;
            } catch (error) {
                Alerta.TratamentoErroComLinha("Upsert.cshtml", "mascaraTelefone", error);
            }
        }

        // --------- CamelCase para Nome ---------
        function toCamelCase(i) {
            try {
                var v = i.value || "";
                // Lista de palavras que devem ficar em minúsculo (preposições, artigos)
                var excecoes = ['de', 'da', 'do', 'das', 'dos', 'e', 'em', 'na', 'no', 'nas', 'nos', 'a', 'o', 'as', 'os'];
                
                v = v.toLowerCase().split(' ').map(function(palavra, index) {
                    if (palavra.length === 0) return '';
                    // Primeira palavra sempre capitalizada, demais verificam exceções
                    if (index === 0 || excecoes.indexOf(palavra) === -1) {
                        return palavra.charAt(0).toUpperCase() + palavra.slice(1);
                    }
                    return palavra;
                }).join(' ');
                
                i.value = v;
            } catch (error) {
                Alerta.TratamentoErroComLinha("Upsert.cshtml", "toCamelCase", error);
            }
        }

        // --------- Normaliza Ponto para p_XXXXX ---------
        function normalizaPonto(i) {
            try {
                var v = i.value || "";
                v = v.trim();
                
                if (v === '') return;
                
                // Remove prefixo existente (p_, P_, p, P seguido de número)
                if (v.toUpperCase().startsWith('P_')) {
                    v = v.substring(2);
                } else if (v.toUpperCase().startsWith('P') && v.length > 1 && !isNaN(v.charAt(1))) {
                    v = v.substring(1);
                }
                
                // Adiciona prefixo p_ minúsculo
                i.value = 'p_' + v;
            } catch (error) {
                Alerta.TratamentoErroComLinha("Upsert.cshtml", "normalizaPonto", error);
            }
        }

        // --------- Valida CPF ---------
        function validaCPF(i) {
            try {
                var cpf = i.value || "";
                
                // Remove caracteres não numéricos
                cpf = cpf.replace(/\D/g, '');
                
                // Se vazio, não valida
                if (cpf.length === 0) return true;
                
                // Verifica se tem 11 dígitos
                if (cpf.length !== 11) {
                    AppToast.show("Vermelho", "CPF deve ter 11 dígitos!", 3000);
                    i.value = '';
                    i.focus();
                    return false;
                }
                
                // Verifica se todos os dígitos são iguais (ex: 111.111.111-11)
                if (/^(\d)\1+$/.test(cpf)) {
                    AppToast.show("Vermelho", "CPF inválido!", 3000);
                    i.value = '';
                    i.focus();
                    return false;
                }
                
                // Validação do primeiro dígito verificador
                var soma = 0;
                for (var j = 0; j < 9; j++) {
                    soma += parseInt(cpf.charAt(j)) * (10 - j);
                }
                var resto = (soma * 10) % 11;
                if (resto === 10 || resto === 11) resto = 0;
                if (resto !== parseInt(cpf.charAt(9))) {
                    AppToast.show("Vermelho", "CPF inválido!", 3000);
                    i.value = '';
                    i.focus();
                    return false;
                }
                
                // Validação do segundo dígito verificador
                soma = 0;
                for (var k = 0; k < 10; k++) {
                    soma += parseInt(cpf.charAt(k)) * (11 - k);
                }
                resto = (soma * 10) % 11;
                if (resto === 10 || resto === 11) resto = 0;
                if (resto !== parseInt(cpf.charAt(10))) {
                    AppToast.show("Vermelho", "CPF inválido!", 3000);
                    i.value = '';
                    i.focus();
                    return false;
                }
                
                return true;
            } catch (error) {
                Alerta.TratamentoErroComLinha("Upsert.cshtml", "validaCPF", error);
                return false;
            }
        }

        // --------- Valida Data ---------
        function validaData(i, nomeCampo) {
            try {
                var valor = i.value || "";
                
                // Se vazio, não valida
                if (valor === '') return true;
                
                var data = new Date(valor);
                var hoje = new Date();
                var anoAtual = hoje.getFullYear();
                var ano = data.getFullYear();
                
                // Verifica se a data é válida
                if (isNaN(data.getTime())) {
                    AppToast.show("Vermelho", nomeCampo + " inválida!", 3000);
                    i.value = '';
                    i.focus();
                    return false;
                }
                
                // Verifica se o ano é razoável (entre 1900 e ano atual + 1)
                if (ano < 1900 || ano > anoAtual + 1) {
                    AppToast.show("Vermelho", nomeCampo + " inválida! Ano fora do intervalo permitido.", 3000);
                    i.value = '';
                    i.focus();
                    return false;
                }
                
                // Para Data de Nascimento: não pode ser no futuro e idade mínima 16 anos
                if (nomeCampo === 'Data de Nascimento') {
                    if (data > hoje) {
                        AppToast.show("Vermelho", "Data de Nascimento não pode ser no futuro!", 3000);
                        i.value = '';
                        i.focus();
                        return false;
                    }
                    
                    var idade = anoAtual - ano;
                    var mesAtual = hoje.getMonth();
                    var mesNasc = data.getMonth();
                    if (mesNasc > mesAtual || (mesNasc === mesAtual && data.getDate() > hoje.getDate())) {
                        idade--;
                    }
                    
                    if (idade < 16) {
                        AppToast.show("Vermelho", "Idade mínima é 16 anos!", 3000);
                        i.value = '';
                        i.focus();
                        return false;
                    }
                    
                    if (idade > 100) {
                        AppToast.show("Vermelho", "Data de Nascimento inválida!", 3000);
                        i.value = '';
                        i.focus();
                        return false;
                    }
                }
                
                // Para Data de Ingresso: não pode ser no futuro
                if (nomeCampo === 'Data de Ingresso') {
                    if (data > hoje) {
                        AppToast.show("Vermelho", "Data de Ingresso não pode ser no futuro!", 3000);
                        i.value = '';
                        i.focus();
                        return false;
                    }
                }
                
                return true;
            } catch (error) {
                Alerta.TratamentoErroComLinha("Upsert.cshtml", "validaData", error);
                return false;
            }
        }

        // --------- Preview da Foto ---------
        $("#txtFile").on("change", function (event) {
            try {
                var files = event.target.files;
                if (files && files[0]) {
                    $("#imgViewer").attr("src", window.URL.createObjectURL(files[0]));
                }
            } catch (error) {
                Alerta.TratamentoErroComLinha("Upsert.cshtml", "txtFile.change", error);
            }
        });

        // --------- Inicialização ---------
        $(document).ready(function () {
            try {
                const encarregadoId = '@Model.EncarregadoObj.Encarregado.EncarregadoId';
                const idVazio = '00000000-0000-0000-0000-000000000000';

                // Aplica máscara nos campos de celular ao carregar
                var celular01 = document.getElementById('EncarregadoObj_Encarregado_Celular01');
                var celular02 = document.getElementById('EncarregadoObj_Encarregado_Celular02');
                
                if (celular01 && celular01.value) {
                    mascaraTelefone(celular01);
                }
                if (celular02 && celular02.value) {
                    mascaraTelefone(celular02);
                }

                if (encarregadoId && encarregadoId !== idVazio) {
                    // Edição: carrega foto do backend
                    $.ajax({
                        type: "GET",
                        url: "/api/Encarregado/PegaFoto",
                        data: { id: encarregadoId },
                        success: function (data) {
                            try {
                                if (data && data.foto) {
                                    $('#imgViewer').attr('src', "data:image/jpg;base64," + data.foto);
                                } else {
                                    $('#imgViewer').attr('src', "/Images/barbudo.jpg");
                                }
                            } catch (error) {
                                Alerta.TratamentoErroComLinha("Upsert.cshtml", "PegaFoto.success", error);
                            }
                        },
                        error: function (xhr) {
                            try {
                                console.warn('Erro ao carregar foto:', xhr);
                                $('#imgViewer').attr('src', "/Images/barbudo.jpg");
                            } catch (error) {
                                Alerta.TratamentoErroComLinha("Upsert.cshtml", "PegaFoto.error", error);
                            }
                        }
                    });
                } else {
                    // Inserção: foto padrão + marca Status como ativo
                    $('#imgViewer').attr('src', "/Images/barbudo.jpg");
                    $('#chkStatus').prop('checked', true);
                }
            } catch (error) {
                Alerta.TratamentoErroComLinha("Upsert.cshtml", "document.ready", error);
            }
        });
    </script>
}
