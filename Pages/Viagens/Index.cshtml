@page

@using FrotiX.Repository.IRepository
@using Syncfusion.EJ2
@using Stimulsoft.Report.Mvc
@using FrotiX.Helpers

@inject IUnitOfWork _unitOfWork

@functions {
	public void OnGet()
	{
		FrotiX.Pages.Viagens.IndexModel.Initialize(_unitOfWork);
		ViewData["dataCombustivel"] = new ListaNivelCombustivel(_unitOfWork).NivelCombustivelList();
		ViewData["lstMotorista"] = new ListaMotorista(_unitOfWork).MotoristaList();
		ViewData["lstVeiculos"] = new ListaVeiculos(_unitOfWork).VeiculosList();
		ViewData["lstSetor"] = new ListaSetores(_unitOfWork).SetoresList();
		ViewData["dataSetor"] = new ListaSetores(_unitOfWork).SetoresList();
		ViewData["lstStatus"] = new ListaStatus(_unitOfWork).StatusList();
		ViewData["lstEventos"] = new ListaEvento(_unitOfWork).EventosList();
	}

	public void OnPost()
	{
		// Console.WriteLine(FrotiX.Pages.Viagens.IndexModel.ViagemId);
	}
}

@model FrotiX.Models.ViewViagens

@{
	ViewData["Title"] = "Viagens";
	ViewData["PageName"] = "viagens_index";
	ViewData["Heading"] = "<i class='fa-duotone fa-route'></i> Cadastros: <span class='fw-300'>Viagens</span>";
	ViewData["Category1"] = "Cadastros";
	ViewData["PageIcon"] = "fa-duotone fa-route";
}

@section HeadBlock {
    <link href="~/css/viagemindex.css" rel="stylesheet" asp-append-version="true" />
}

<style>
	/* ============================================================
	   Estilos específicos da página Viagens - MODERNIZADO
	   ============================================================ */

	/* ======== ANIMAÇÃO SUAVE DO HEADER ======== */
	@@keyframes headerGradientShift {
		0% {
			background-position: 0% 50%;
		}
		50% {
			background-position: 100% 50%;
		}
		100% {
			background-position: 0% 50%;
		}
	}

	/* ======== CORREÇÃO DO HEADER DO CARD ======== */
	.ftx-card-header {
		background: linear-gradient(135deg, #325d88 0%, #2a4d73 25%, #3d6f9e 50%, #2a4d73 75%, #325d88 100%);
		background-size: 400% 400%;
		animation: headerGradientShift 8s ease infinite;
	}

	/* ======== CORREÇÃO DA FONTE DO TÍTULO ======== */
	.ftx-card-header .titulo-paginas {
		font-family: 'Outfit', sans-serif !important;
		font-weight: 900 !important;
		font-size: 1.925rem !important;
		color: #ffffff !important;
		text-shadow: 0 2px 4px rgba(0, 0, 0, 0.25) !important;
	}

	/* ======== OUTLINE BRANCO NO BOTÃO DO HEADER ======== */
	.ftx-card-header .btn-fundo-laranja {
		outline: 2px solid rgba(255, 255, 255, 0.5) !important;
		outline-offset: 1px;
		transition: all 0.2s ease;
	}

	.ftx-card-header .btn-fundo-laranja:hover {
		outline: 2px solid rgba(255, 255, 255, 0.8) !important;
		outline-offset: 2px;
	}

	/* Micro botão para grid de Ação */
	.btn-xxs {
		--bs-btn-padding-y: .15rem;
		--bs-btn-padding-x: .35rem;
		--bs-btn-font-size: .70rem;
		line-height: 1;
		border-radius: .2rem;
	}

	/* Tipografia e alinhamento do grid */
	#tblViagem, #tblViagem th, #tblViagem td {
		font-size: .82rem;
	}

	#tblViagem thead th {
		font-size: .86rem;
		font-weight: 700;
	}

	#tblViagem th, #tblViagem td {
		vertical-align: middle !important;
	}

	/* Botões de ação na coluna 9 */
	#tblViagem td:nth-child(9) .btn {
		width: 32px;
		height: 30px;
		padding: 0 !important;
		display: inline-flex;
		align-items: center;
		justify-content: center;
		border-radius: .30rem !important;
		--bs-btn-font-size: .75rem;
		line-height: 1;
		margin: 2px;
	}

	#tblViagem td:last-child .btn i {
		font-size: .95rem;
		line-height: 1;
	}

	#tblViagem td:last-child .text-center,
	#tblViagem td:last-child > div {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: 4px;
		flex-wrap: nowrap;
		height: 100%;
	}

	/* ===== BADGES DE STATUS - PADRONIZADOS ===== */
	.ftx-badge-status {
		display: inline-flex !important;
		align-items: center !important;
		justify-content: center !important;
		padding: .35rem .75rem !important;
		min-height: 1.65rem;
		min-width: 5.5rem;
		white-space: nowrap;
		font-size: .78rem !important;
		font-weight: 600 !important;
		line-height: 1 !important;
		border-radius: 9999px !important;
		color: #fff !important;
		text-transform: uppercase;
		letter-spacing: 0.3px;
		transition: all 0.2s ease;
		box-shadow: 0 2px 4px rgba(0,0,0,0.15) !important;
	}

	.ftx-badge-status:hover {
		transform: translateY(-1px);
		box-shadow: 0 4px 8px rgba(0,0,0,0.2) !important;
	}

	.ftx-badge-status i {
		margin-right: .35rem;
		line-height: 1;
	}

	/* ===== BADGES DE STATUS VIAGEM - COM ÍCONES (Padrão Manutenção) ===== */
	.ftx-viagem-badge {
		display: inline-flex;
		align-items: center;
		gap: 0.35rem;
		padding: 0.25rem 0.65rem;
		border-radius: 1rem;
		font-size: 0.72rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.3px;
		white-space: nowrap;
		min-width: 5.8rem;
		justify-content: center;
		transition: all 0.2s ease;
		text-decoration: none !important;
		cursor: default;
	}

	.ftx-viagem-badge:hover {
		transform: translateY(-1px);
	}

	.ftx-viagem-badge i {
		color: #fff !important;
		font-size: 0.75rem;
	}

	/* Aberta - Verde */
	.ftx-viagem-badge-aberta {
		background: linear-gradient(135deg, #198754 0%, #157347 100%);
		color: #fff !important;
		box-shadow: 0 2px 4px rgba(25, 135, 84, 0.3);
	}

	.ftx-viagem-badge-aberta:hover {
		box-shadow: 0 4px 8px rgba(25, 135, 84, 0.4);
	}

	/* Realizada (equivalente a Fechada) - Cinza/Verde Escuro */
	.ftx-viagem-badge-realizada {
		background: linear-gradient(135deg, #2F4F4F 0%, #1e3a3a 100%);
		color: #fff !important;
		box-shadow: 0 2px 4px rgba(47, 79, 79, 0.3);
	}

	.ftx-viagem-badge-realizada:hover {
		box-shadow: 0 4px 8px rgba(47, 79, 79, 0.4);
	}

	/* Cancelada - Vinho */
	.ftx-viagem-badge-cancelada {
		background: linear-gradient(135deg, #561D2D 0%, #3d1520 100%);
		color: #fff !important;
		box-shadow: 0 2px 4px rgba(86, 29, 45, 0.3);
	}

	.ftx-viagem-badge-cancelada:hover {
		box-shadow: 0 4px 8px rgba(86, 29, 45, 0.4);
	}

	/* ===== BADGES DE OCORRÊNCIA ===== */
	.ftx-ocorrencia-badge {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		min-width: 70px;
		padding: 0.25rem 0.6rem;
		border-radius: 50px;
		color: #fff !important;
		font-size: 0.7rem;
		font-weight: 600;
		letter-spacing: 0.3px;
		text-transform: uppercase;
	}

	.ftx-ocorrencia-badge-aberta {
		background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
		box-shadow: 0 2px 6px rgba(39, 174, 96, 0.35);
	}

	.ftx-ocorrencia-badge-baixada {
		background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
		box-shadow: 0 2px 6px rgba(127, 140, 141, 0.35);
	}

	.ftx-ocorrencia-badge-pendente {
		background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
		box-shadow: 0 2px 6px rgba(255, 165, 0, 0.35);
	}

	.ftx-ocorrencia-badge-manutencao {
		background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
		box-shadow: 0 2px 6px rgba(52, 152, 219, 0.35);
	}

	/* ===== BOTÕES DA TABELA - COM GLOW E ANIMAÇÃO ===== */
	#tblViagem .btn-imprimir {
		background-color: #4B0082 !important;
		border: none !important;
		color: #fff !important;
		box-shadow: 0 0 8px rgba(75,0,130,.5), 0 2px 4px rgba(75,0,130,.3) !important;
		transition: all 0.3s ease !important;
	}
	#tblViagem .btn-imprimir:hover {
		background-color: #3A006B !important;
		animation: buttonWiggle 0.5s ease-in-out !important;
		box-shadow: 0 0 25px rgba(75,0,130,.8), 0 6px 15px rgba(75,0,130,.5) !important;
	}

	#tblViagem .btn-finalizar-viagem {
		background-color: #2F4F4F !important;
		border: none !important;
		color: #fff !important;
		box-shadow: 0 0 8px rgba(47,79,79,.5), 0 2px 4px rgba(47,79,79,.3) !important;
		transition: all 0.3s ease !important;
	}
	#tblViagem .btn-finalizar-viagem:hover {
		background-color: #253A3A !important;
		animation: buttonWiggle 0.5s ease-in-out !important;
		box-shadow: 0 0 25px rgba(47,79,79,.8), 0 6px 15px rgba(47,79,79,.5) !important;
	}

	#tblViagem .btn-cancelar-viagem {
		background-color: #722F37 !important;
		border: none !important;
		color: #fff !important;
		box-shadow: 0 0 8px rgba(114,47,55,.5), 0 2px 4px rgba(114,47,55,.3) !important;
		transition: all 0.3s ease !important;
	}
	#tblViagem .btn-cancelar-viagem:hover {
		background-color: #5a252c !important;
		animation: buttonWiggle 0.5s ease-in-out !important;
		box-shadow: 0 0 25px rgba(114,47,55,.8), 0 6px 15px rgba(114,47,55,.5) !important;
	}

	/* ===== BOTÃO ADICIONAR OCORRÊNCIA (LARANJA) ===== */
	#modalFinalizaViagem .btn-outline-secondary,
	#modalFinalizaViagem [id*="btnAdd"],
	#modalFinalizaViagem [id*="Adicionar"],
	.secao-ocorrencias .btn-outline-secondary,
	.btn-adicionar-ocorrencia {
		background-color: #A0522D !important;
		border-color: #8B4513 !important;
		color: #fff !important;
		box-shadow: 0 0 8px rgba(160,82,45,.5), 0 2px 4px rgba(160,82,45,.3) !important;
		transition: all 0.3s ease !important;
	}
	#modalFinalizaViagem .btn-outline-secondary:hover,
	#modalFinalizaViagem [id*="btnAdd"]:hover,
	#modalFinalizaViagem [id*="Adicionar"]:hover,
	.secao-ocorrencias .btn-outline-secondary:hover,
	.btn-adicionar-ocorrencia:hover {
		background-color: #8B4513 !important;
		border-color: #6B3410 !important;
		animation: buttonWiggle 0.5s ease-in-out !important;
		box-shadow: 0 0 20px rgba(160,82,45,.8), 0 6px 12px rgba(160,82,45,.5) !important;
		color: #fff !important;
	}

	/* ===== UNIFORMIZA ALTURA DOS DROPDOWNS DE COMBUSTÍVEL ===== */
	#modalFinalizaViagem .e-ddt,
	#modalFinalizaViagem .e-dropdowntree {
		height: 38px !important;
		min-height: 38px !important;
		border-bottom: 1px solid #ccc !important;
	}
	#modalFinalizaViagem .e-ddt .e-ddt-icon,
	#modalFinalizaViagem .e-dropdowntree .e-ddt-icon {
		height: 36px !important;
		line-height: 36px !important;
	}
	#modalFinalizaViagem .e-ddt input.e-dropdowntree,
	#modalFinalizaViagem .e-ddt .e-overflow {
		height: 36px !important;
		line-height: 36px !important;
		padding-top: 0 !important;
		padding-bottom: 0 !important;
	}

	/* LARGURA dos modais específicos */
	#modalFicha .modal-dialog {
		--bs-modal-width: 700px;
	}

	#modalFicha .modal-header, #modalFicha .modal-footer {
		padding: .75rem 1rem;
	}

	#modalFicha .modal-body {
		padding: 1rem;
	}

	/* Área do relatório */
	#ReportContainer {
		min-height: 700px;
	}

	#reportViewer1 {
		width: 100%;
	}

	/* Estados de validação */
	:root {
		--ftx-invalid: #dc3545;
		--ftx-glow: rgba(220,53,69,.18);
		--ftx-glow-focus: rgba(220,53,69,.28);
		--ftx-high: #fd7e14;
		--ftx-high-glow: rgba(253,126,20,.18);
	}

	input.is-invalid, textarea.is-invalid {
		border-color: var(--ftx-invalid) !important;
		color: var(--ftx-invalid) !important;
		box-shadow: 0 0 0 .2rem var(--ftx-glow);
	}

	input.is-invalid:focus, textarea.is-invalid:focus {
		box-shadow: 0 0 0 .28rem var(--ftx-glow-focus);
	}

	.e-input-group.is-invalid, .e-float-input.is-invalid, .e-control-wrapper.is-invalid {
		box-shadow: 0 0 0 .2rem var(--ftx-glow);
		border-radius: .25rem;
	}

	.e-input-group.is-invalid:focus-within, .e-float-input.is-invalid:focus-within, .e-control-wrapper.is-invalid:focus-within {
		box-shadow: 0 0 0 .28rem var(--ftx-glow-focus);
	}

	.e-input-group.is-invalid .e-input, .e-float-input.is-invalid input, .e-control-wrapper.is-invalid input {
		border-color: var(--ftx-invalid) !important;
		color: var(--ftx-invalid) !important;
	}

	input.is-high, textarea.is-high {
		box-shadow: 0 0 0 .2rem var(--ftx-high-glow);
	}

	.e-input-group.is-high, .e-float-input.is-high, .e-control-wrapper.is-high {
		box-shadow: 0 0 0 .2rem var(--ftx-high-glow);
		border-radius: .25rem;
	}

	/* Loading spinner específico do ModalFicha */
	#modalFicha #loadingSpinner {
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%,-50%);
		z-index: 10;
		background: rgba(255,255,255,0.9);
		padding: 30px;
		border-radius: 8px;
	}

	#modalFicha #uploadContainer, #modalFicha #imageContainer {
		transition: opacity .3s ease;
	}

	/* Botão alterar ficha */
	#btnAlterarFicha {
		transition: all .3s ease;
		border: 1px solid transparent;
	}

	#btnAlterarFicha:hover {
		background-color: #333;
		border-color: #333;
		color: #fff;
		box-shadow: 0 0 4px rgba(51,51,51,.6);
	}

	/* Espaços do DataTables desta página */
	#tblViagem_wrapper .row {
		margin-top: .25rem;
		margin-bottom: .5rem;
	}

	#tblViagem_wrapper .dataTables_length,
	#tblViagem_wrapper .dt-buttons,
	#tblViagem_wrapper .dataTables_filter {
		margin-top: .25rem;
		margin-bottom: .25rem;
	}

	/* ===== LABELS MODERNIZADOS ===== */
	.ftx-label {
		font-weight: 600;
		color: #495057;
		margin-bottom: 0.5rem;
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}

	.ftx-label i {
		color: #722F37;
		font-size: 0.9rem;
	}

	/* ===== FORM CONTROLS MELHORADOS ===== */
	.form-control:focus {
		border-color: #325d88;
		box-shadow: 0 0 0 0.2rem rgba(50, 93, 136, 0.25);
	}

	/* ===== FILTROS ESTILIZADOS ===== */
	.ftx-filtros {
		background: linear-gradient(180deg, #f8f9fa 0%, #fff 100%);
		border-radius: 12px;
		padding: 1.25rem;
		margin-bottom: 1.5rem;
		border: 1px solid rgba(0,0,0,0.08);
	}

	/* Uniformiza altura de todos os controles de filtro */
	.ftx-filtros input[type="date"],
	.ftx-filtros .form-control,
	.ftx-filtros .e-input-group,
	.ftx-filtros .e-control-wrapper,
	.ftx-filtros .e-ddl,
	.ftx-filtros .e-combobox {
		height: 38px !important;
		min-height: 38px !important;
	}

	.ftx-filtros .e-input-group input,
	.ftx-filtros .e-control-wrapper input {
		height: 100% !important;
		padding-top: 0 !important;
		padding-bottom: 0 !important;
	}

	/* ================================================================
	   MODAL DE LOADING - PADRÃO FROTIX
	   ================================================================ */
	#modalLoadingViagens .modal-dialog {
		max-width: 360px;
	}

	#modalLoadingViagens .modal-content {
		border: none;
		border-radius: 16px;
		overflow: hidden;
		box-shadow: 0 10px 40px rgba(0,0,0,0.3);
	}

	#modalLoadingViagens .modal-header {
		background: linear-gradient(135deg, #325d88 0%, #2a4d73 50%, #3d6f9e 100%);
		background-size: 200% 200%;
		animation: headerGradientShift 4s ease infinite;
		border-bottom: none;
		padding: 1rem 1.25rem;
		position: relative;
		overflow: hidden;
	}

	/* Efeito de brilho no header do modal */
	#modalLoadingViagens .modal-header::before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.08), transparent);
		animation: ftxModalShine 5s ease-in-out infinite;
		pointer-events: none;
	}

	@@keyframes ftxModalShine {
		0%, 100% { left: -100%; }
		50% { left: 100%; }
	}

	#modalLoadingViagens .modal-title {
		font-family: 'Outfit', sans-serif;
		font-weight: 700;
		font-size: 1.1rem;
		color: #fff;
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}

	/* Ícone duotone com cores amarelo/branco e animação pulsante */
	#modalLoadingViagens .modal-title i {
		font-size: 1.3rem;
		--fa-primary-color: #ffd700;
		--fa-secondary-color: #ffffff;
		--fa-secondary-opacity: 0.8;
		animation: ftxLoadingIconPulse 2s ease-in-out infinite;
		filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
	}

	@@keyframes ftxLoadingIconPulse {
		0%, 100% { 
			transform: scale(1); 
			filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
		}
		50% { 
			transform: scale(1.12); 
			filter: drop-shadow(0 3px 6px rgba(255, 215, 0, 0.4));
		}
	}

	#modalLoadingViagens .modal-body {
		padding: 2rem 1.5rem;
		text-align: center;
		background: #fff;
	}

	/* Spinner duplo estilizado */
	.ftx-loading-spinner {
		width: 64px;
		height: 64px;
		border-radius: 50%;
		border: 5px solid transparent;
		border-top-color: #325d88;
		animation: ftxLoadingSpin 1s linear infinite;
		margin: 0 auto 1.25rem;
		position: relative;
	}

	.ftx-loading-spinner::before {
		content: "";
		position: absolute;
		inset: 5px;
		border-radius: 50%;
		border: 5px solid transparent;
		border-right-color: #22d3ee;
		animation: ftxLoadingSpin 0.75s linear infinite reverse;
	}

	@@keyframes ftxLoadingSpin {
		to { transform: rotate(360deg); }
	}

	.ftx-loading-text {
		font-family: 'Outfit', sans-serif;
		font-size: 1rem;
		font-weight: 600;
		color: #333;
		margin-bottom: 0.5rem;
	}

	.ftx-loading-subtext {
		font-size: 0.85rem;
		color: #6c757d;
	}

	/* ================================================================
	   AVISO DE FILTRO DO DATATABLE
	   ================================================================ */
	.ftx-filter-hint {
		display: inline-flex;
		align-items: center;
		gap: 0.4rem;
		font-size: 0.78rem;
		color: #6c757d;
		background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
		padding: 0.35rem 0.75rem;
		border-radius: 20px;
		border: 1px solid #dee2e6;
		margin-left: 0.75rem;
		white-space: nowrap;
		transition: all 0.2s ease;
	}

	.ftx-filter-hint:hover {
		background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
		border-color: #adb5bd;
		color: #495057;
	}

	.ftx-filter-hint i {
		color: #325d88;
		font-size: 0.85rem;
	}

	/* Posiciona o aviso junto ao campo de pesquisa */
	#tblViagem_wrapper .dataTables_filter {
		display: flex !important;
		align-items: center !important;
		flex-wrap: wrap;
	}

	#tblViagem_wrapper .dataTables_filter label {
		display: flex !important;
		align-items: center !important;
		gap: 0.5rem;
	}
</style>

<script>
	var defaultRTE;
	var defaultRTEDescricao;

	function onCreate() {
		try {
			defaultRTE = this;
		} catch (error) {
			Alerta.TratamentoErroComLinha("Index.cshtml", "onCreate", error);
		}
	}

	function onCreateDescricao() {
		try {
			defaultRTEDescricao = this;
		} catch (error) {
			Alerta.TratamentoErroComLinha("Index.cshtml", "onCreateDescricao", error);
		}
	}
</script>

@*=========================================================================
   MODAL DE LOADING - PADRÃO FROTIX
   =========================================================================*@
<div class="modal fade" id="modalLoadingViagens" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">
					<i class="fa-duotone fa-route"></i>
					<span>Carregando Viagens</span>
				</h5>
			</div>
			<div class="modal-body">
				<div class="ftx-loading-spinner"></div>
				<div class="ftx-loading-text" id="loadingViagensMensagem">Aguarde enquanto carregamos as viagens...</div>
				<div class="ftx-loading-subtext">Isso pode levar alguns segundos</div>
			</div>
		</div>
	</div>
</div>

@* =========================================================================
   SCRIPT INLINE - MOSTRA MODAL DE LOADING IMEDIATAMENTE
   Este script roda ANTES do ViagemIndex.js carregar
   ========================================================================= *@
<script>
(function() {
    'use strict';
    
    // Mostra o modal de loading assim que possível
    function mostrarModalLoading() {
        var modalEl = document.getElementById('modalLoadingViagens');
        if (!modalEl) return;
        
        // Verifica se Bootstrap está disponível
        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
            var existingModal = bootstrap.Modal.getInstance(modalEl);
            if (existingModal) {
                existingModal.show();
            } else {
                var modal = new bootstrap.Modal(modalEl, {
                    backdrop: 'static',
                    keyboard: false
                });
                modal.show();
            }
        } else {
            // Fallback: mostra manualmente se Bootstrap ainda não carregou
            modalEl.classList.add('show');
            modalEl.style.display = 'block';
            modalEl.removeAttribute('aria-hidden');
            document.body.classList.add('modal-open');
            
            // Cria backdrop manualmente se não existir
            if (!document.getElementById('ftx-loading-backdrop')) {
                var backdrop = document.createElement('div');
                backdrop.className = 'modal-backdrop fade show';
                backdrop.id = 'ftx-loading-backdrop';
                document.body.appendChild(backdrop);
            }
        }
    }
    
    // Mostra modal quando DOM estiver minimamente pronto
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', mostrarModalLoading);
    } else {
        // DOM já está pronto
        mostrarModalLoading();
    }
})();
</script>

<form>
	<div class="row">
		<div class="col-xl-12">
			<!-- ============================================
			     CARD COM HEADER ESTILIZADO
			     ============================================ -->
			<div id="panel-1" class="panel ftx-card-styled">
				<div class="panel-container show">
					
					<!-- HEADER DO CARD -->
					<div class="ftx-card-header">
						<h2 class="titulo-paginas">
							<i class="fa-duotone fa-route"></i>
							Controle de Viagens
						</h2>
						<div class="ftx-card-actions">
							<a href="/Viagens/Upsert" class="btn btn-fundo-laranja" data-ftx-loading>
								<i class="fa-duotone fa-route icon-pulse me-1 icon-pulse me-1"></i>
								Adicionar Viagem
							</a>
						</div>
					</div>

					<div class="panel-content">
						<div class="box-body">
							<!-- ===== ÁREA DE FILTROS ===== -->
							<div class="ftx-filtros">
								<div class="row g-3">
									<!-- Data -->
									<div class="col-md-2">
										<label class="ftx-label">
											<i class="fa-duotone fa-calendar"></i>
											Data da Viagem
										</label>
										<input id="txtData" class="form-control" type="date" />
									</div>

									<!-- Veículo -->
									<div class="col-md-2">
										<label class="ftx-label">
											<i class="fa-duotone fa-car"></i>
											Veículo
										</label>
										<ejs-combobox id="lstVeiculos"
													  placeholder="Todos os Veículos"
													  allowFiltering="true"
													  filterType="Contains"
													  dataSource="@ViewData["lstVeiculos"]"
													  popupHeight="250px"
													  width="100%"
													  showClearButton="true">
											<e-combobox-fields text="Descricao" value="VeiculoId"></e-combobox-fields>
										</ejs-combobox>
									</div>

									<!-- Motorista -->
									<div class="col-md-3">
										<label class="ftx-label">
											<i class="fa-duotone fa-id-card"></i>
											Motorista
										</label>
										<ejs-combobox id="lstMotorista"
													  placeholder="Todos os Motoristas"
													  allowFiltering="true"
													  filterType="Contains"
													  dataSource="@ViewData["lstMotorista"]"
													  popupHeight="250px"
													  width="100%"
													  showClearButton="true">
											<e-combobox-fields text="Nome" value="MotoristaId"></e-combobox-fields>
										</ejs-combobox>
									</div>

									<!-- Status -->
									<div class="col-md-2">
										<label class="ftx-label">
											<i class="fa-duotone fa-circle-check"></i>
											Status
										</label>
										<ejs-combobox id="lstStatus"
													  placeholder="Todos os Status"
													  allowFiltering="true"
													  filterType="Contains"
													  dataSource="@ViewData["lstStatus"]"
													  popupHeight="250px"
													  width="100%"
													  showClearButton="true">
											<e-combobox-fields text="Status" value="StatusId"></e-combobox-fields>
										</ejs-combobox>
									</div>

									<!-- Evento -->
									<div class="col-md-3">
										<label class="ftx-label">
											<i class="fa-duotone fa-calendar-star"></i>
											Evento
										</label>
										<ejs-combobox id="lstEventos"
													  placeholder="Todos os Eventos"
													  allowFiltering="true"
													  filterType="Contains"
													  dataSource="@ViewData["lstEventos"]"
													  popupHeight="250px"
													  width="100%"
													  showClearButton="true">
											<e-combobox-fields text="Evento" value="EventoId"></e-combobox-fields>
										</ejs-combobox>
									</div>
								</div>

								<!-- Botão Filtrar -->
								<div class="row mt-3">
									<div class="col-md-4">
										<button type="button"
												class="btn btn-fundo-laranja text-white w-100"
												id="btnFiltro"
												name="btnFiltro"
												style="height: 44px;"
												onclick="FtxViagens.filtrar()">
											<i class="fa-sharp-duotone fa-duotone fa-filter-list me-2"></i>
											<span>Filtrar Viagens</span>
										</button>
									</div>
								</div>
							</div>

							<!-- ===== TABELA DE VIAGENS ===== -->
							<div id="divViagens">
								<table id="tblViagem" class="table table-bordered table-striped table-hover mt-2 ftx-table" width="100%">
									<thead style="background-color: #4a6fa5 !important;">
										<tr>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Vistoria</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Data</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Início</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Requisitante</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Setor</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Motorista</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Veículo</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Status</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Ação</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;"></th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Km Inicial</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Combustivel Inicial</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Data Final</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Hora Final</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Km Final</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Combustivel Final</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Resumo Ocorrência</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Descrição Ocorrência</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Status Documento</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Status Cartão Abastecimento</th>
											<th style="background-color: #4a6fa5 !important; color: #fff !important;">Descricao</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</form>

@*=========================================================================
   MODAL FINALIZAR VIAGEM - MODERNIZADO
   =========================================================================*@
<div class="modal fade" id="modalFinalizaViagem" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable" role="document">
		<div class="modal-content">
			<div class="modal-header modal-header-vinho">
				<h4 class="modal-title d-flex align-items-center gap-2" id="h3Titulo">
					<i class="fa-duotone fa-flag-checkered" aria-hidden="true"></i>
					<span>Finalizar a Viagem</span>
				</h4>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
			</div>

			<div class="modal-body">
				<form id="frmRequisitante">
					<input type="hidden" id="txtId" />

					<!-- Linha 1: Dados Iniciais -->
					<div class="row g-3 mb-4">
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-calendar-day"></i>
								Data Inicial
							</label>
							<input readonly id="txtDataInicial" class="form-control" />
						</div>
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-clock"></i>
								Hora Inicial
							</label>
							<input readonly id="txtHoraInicial" class="form-control" />
						</div>
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-gauge"></i>
								Km Inicial
							</label>
							<input readonly id="txtKmInicial" class="form-control" />
						</div>
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-gas-pump"></i>
								Combustível Inicial
							</label>
							<ejs-dropdowntree id="ddtCombustivelInicial" 
											  popupHeight="200px" 
											  showClearButton="true" 
											  class="form-control" 
											  enabled="false">
								<e-dropdowntree-fields dataSource="@ViewData["dataCombustivel"]" 
													   value="Nivel" 
													   text="Descricao" 
													   imageURL="Imagem">
								</e-dropdowntree-fields>
							</ejs-dropdowntree>
						</div>
					</div>

					<!-- Separador Visual -->
					<hr class="my-4" style="border-color: rgba(0,0,0,0.1);" />

					<!-- Linha 2: Dados Finais -->
					<div class="row g-3 mb-4">
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-calendar-check"></i>
								Data Final <span class="text-danger">*</span>
							</label>
							<input id="txtDataFinal" type="date" class="form-control" />
						</div>
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-clock"></i>
								Hora Final <span class="text-danger">*</span>
							</label>
							<input id="txtHoraFinal" type="time" class="form-control" />
						</div>
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-gauge-max"></i>
								Km Final <span class="text-danger">*</span>
							</label>
							<input id="txtKmFinal" type="number" class="form-control" placeholder="0" />
						</div>
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-gas-pump"></i>
								Combustível Final <span class="text-danger">*</span>
							</label>
							<ejs-dropdowntree id="ddtCombustivelFinal" 
											  popupHeight="200px" 
											  showClearButton="true" 
											  class="form-control">
								<e-dropdowntree-fields dataSource="@ViewData["dataCombustivel"]" 
													   value="Nivel" 
													   text="Descricao" 
													   imageURL="Imagem">
								</e-dropdowntree-fields>
							</ejs-dropdowntree>
						</div>
					</div>

					<!-- Linha 3: Km Percorrido + Duração -->
					<div class="row g-3 mb-4">
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-road"></i>
								Km Percorrido
							</label>
							<input readonly id="txtKmPercorrido" class="form-control" />
						</div>
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-stopwatch"></i>
								Duração
							</label>
							<input readonly id="txtDuracao" class="form-control" />
						</div>
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-file-check"></i>
								Status Documento
							</label>
							<div class="form-check form-switch mt-2">
								<input class="form-check-input" type="checkbox" id="chkStatusDocumento" checked />
								<label class="form-check-label" for="chkStatusDocumento">Entregue</label>
							</div>
						</div>
						<div class="col-md-3">
							<label class="ftx-label">
								<i class="fa-duotone fa-credit-card"></i>
								Cartão Abastecimento
							</label>
							<div class="form-check form-switch mt-2">
								<input class="form-check-input" type="checkbox" id="chkStatusCartaoAbastecimento" checked />
								<label class="form-check-label" for="chkStatusCartaoAbastecimento">Entregue</label>
							</div>
						</div>
					</div>

					<!-- Descrição -->
					<div class="row g-3 mb-3">
						<div class="col-12">
							<label class="ftx-label">
								<i class="fa-duotone fa-align-left"></i>
								Descrição / Observações
							</label>
							<ejs-richtexteditor id="rteDescricao" 
												placeholder="Digite observações sobre a viagem..." 
												height="150px"
												created="onCreateDescricao">
							</ejs-richtexteditor>
						</div>
					</div>

					<!-- Seção de Ocorrências -->
					<div class="secao-ocorrencias mt-4">
						<div class="d-flex justify-content-between align-items-center mb-3">
							<h5 class="mb-0">
								<i class="fa-duotone fa-car-burst me-2 text-danger"></i>
								Ocorrências da Viagem
							</h5>
							<button type="button" class="btn btn-adicionar-ocorrencia btn-sm" id="btnAdicionarOcorrencia">
								<i class="fa-duotone fa-plus me-1"></i> Adicionar Ocorrência
							</button>
						</div>
						<div id="listaOcorrencias">
							<!-- Ocorrências serão inseridas aqui dinamicamente -->
						</div>
					</div>
				</form>
			</div>

			<div class="modal-footer">
				<button type="button" class="btn btn-vinho" data-bs-dismiss="modal">
					<i class="fa-duotone fa-rotate-left icon-space icon-rotate-left"></i> Fechar
				</button>
				<button type="button" class="btn btn-verde" id="btnFinalizarViagem">
					<i class="fa-duotone fa-check me-1"></i> Finalizar Viagem
				</button>
			</div>
		</div>
	</div>
</div>

@*=========================================================================
   MODAL CUSTOS DA VIAGEM - MODERNIZADO
   =========================================================================*@
<div class="modal fade" id="modalCustosViagem" tabindex="-1" aria-labelledby="modalCustosViagemLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header modal-header-dinheiro">
                <h4 class="modal-title d-flex align-items-center gap-2" id="modalCustosViagemLabel">
                    <i class="fa-duotone fa-money-bill-trend-up" aria-hidden="true"></i>
                    <span>Custos da Viagem</span>
                </h4>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>

            <div class="modal-body">
                <!-- Hidden para armazenar o ID da viagem -->
                <input type="hidden" id="hiddenCustosViagemId" />

                <!-- Informações da Viagem -->
                <div class="row mb-3">
                    <div class="col-12">
                        <h6 class="text-muted mb-2">
                            <i class="fa-duotone fa-route me-1"></i>
                            Viagem Nº <strong id="spanNumeroViagem">-</strong>
                        </h6>
                        <small class="text-muted" id="spanInfoViagem">Carregando...</small>
                    </div>
                </div>

                <!-- Estatísticas da Viagem -->
                <div class="row g-3 mb-4">
                    <!-- Duração -->
                    <div class="col-md-3 col-6">
                        <div class="stat-card">
                            <i class="fa-duotone fa-clock stat-icon icon-duracao"></i>
                            <div class="stat-label">Duração</div>
                            <div class="stat-valor" id="spanDuracao">-</div>
                        </div>
                    </div>
                    <!-- Quilometragem -->
                    <div class="col-md-3 col-6">
                        <div class="stat-card">
                            <i class="fa-duotone fa-gauge-high stat-icon icon-km"></i>
                            <div class="stat-label">Km Percorrido</div>
                            <div class="stat-valor" id="spanKm">-</div>
                        </div>
                    </div>
                    <!-- Litros Gastos -->
                    <div class="col-md-3 col-6">
                        <div class="stat-card">
                            <i class="fa-duotone fa-gas-pump stat-icon icon-litros"></i>
                            <div class="stat-label">Litros Gastos</div>
                            <div class="stat-valor" id="spanLitros">-</div>
                        </div>
                    </div>
                    <!-- Consumo -->
                    <div class="col-md-3 col-6">
                        <div class="stat-card">
                            <i class="fa-duotone fa-leaf stat-icon icon-consumo"></i>
                            <div class="stat-label">Consumo</div>
                            <div class="stat-valor" id="spanConsumo">-</div>
                        </div>
                    </div>
                </div>

                <!-- Tipo de Combustível -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="alert alert-info d-flex align-items-center py-2 mb-0" role="alert">
                            <i class="fa-duotone fa-gas-pump-slash me-2" style="font-size: 1.25rem;"></i>
                            <span>Combustível: <strong id="spanTipoCombustivel">-</strong></span>
                        </div>
                    </div>
                </div>

                <!-- Seção de Custos Detalhados -->
                <div class="custos-section">
                    <div class="section-title">
                        <i class="fa-duotone fa-coins"></i>
                        <span>Detalhamento de Custos</span>
                    </div>

                    <div class="row g-3">
                        <!-- Custo Motorista -->
                        <div class="col-md-4 col-6">
                            <div class="custo-card">
                                <i class="fa-duotone fa-id-card-clip custo-icon icon-motorista"></i>
                                <div class="custo-label">Motorista</div>
                                <div class="custo-valor" id="spanCustoMotorista">R$ 0,00</div>
                            </div>
                        </div>
                        <!-- Custo Veículo -->
                        <div class="col-md-4 col-6">
                            <div class="custo-card">
                                <i class="fa-duotone fa-car-bus custo-icon icon-veiculo"></i>
                                <div class="custo-label">Veículo</div>
                                <div class="custo-valor" id="spanCustoVeiculo">R$ 0,00</div>
                            </div>
                        </div>
                        <!-- Custo Combustível -->
                        <div class="col-md-4 col-6">
                            <div class="custo-card">
                                <i class="fa-duotone fa-gas-pump custo-icon icon-combustivel"></i>
                                <div class="custo-label">Combustível</div>
                                <div class="custo-valor" id="spanCustoCombustivel">R$ 0,00</div>
                            </div>
                        </div>
                        <!-- Custo Operador -->
                        <div class="col-md-6 col-6">
                            <div class="custo-card">
                                <i class="fa-duotone fa-user-headset custo-icon icon-operador"></i>
                                <div class="custo-label">Operador</div>
                                <div class="custo-valor" id="spanCustoOperador">R$ 0,00</div>
                            </div>
                        </div>
                        <!-- Custo Lavador -->
                        <div class="col-md-6 col-6">
                            <div class="custo-card">
                                <i class="fa-duotone fa-car-wash custo-icon icon-lavador"></i>
                                <div class="custo-label">Lavador</div>
                                <div class="custo-valor" id="spanCustoLavador">R$ 0,00</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Geral - Compacto -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="custo-total-card">
                            <i class="fa-duotone fa-sack-dollar custo-icon"></i>
                            <div class="custo-info">
                                <div class="custo-label">Custo Total da Viagem</div>
                                <div class="custo-valor" id="spanCustoTotal">R$ 0,00</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-vinho" data-bs-dismiss="modal">
                    <i class="fa-duotone fa-rotate-left icon-space icon-rotate-left"></i> Fechar
                </button>
            </div>
        </div>
    </div>
</div>

@*=========================================================================
   MODAL SOLUÇÃO DA OCORRÊNCIA (PARA BAIXA)
   =========================================================================*@
<div class="modal fade" id="modalSolucaoOcorrencia" tabindex="-1" aria-labelledby="modalSolucaoOcorrenciaLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header modal-header-verde">
				<h5 class="modal-title d-flex align-items-center gap-2" id="modalSolucaoOcorrenciaLabel">
					<i class="fa-duotone fa-clipboard-check" aria-hidden="true"></i>
					<span>Informar Solução</span>
				</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
			</div>

			<div class="modal-body">
				<input type="hidden" id="hiddenBaixaOcorrenciaId" />
				
				<div class="mb-3">
					<label for="txtSolucaoBaixa" class="form-label fw-semibold">
						<i class="fa-duotone fa-message-lines me-1 text-success"></i>
						Descreva a solução aplicada
					</label>
					<textarea id="txtSolucaoBaixa" 
							  class="form-control" 
							  rows="4" 
							  placeholder="Informe como a ocorrência foi resolvida..."></textarea>
				</div>
			</div>

			<div class="modal-footer">
				<button type="button" class="btn btn-vinho" data-bs-dismiss="modal">
					<i class="fa-duotone fa-xmark me-1"></i> Cancelar
				</button>
				<button type="button" id="btnConfirmarBaixaSolucao" class="btn btn-verde">
					<i class="fa-duotone fa-check me-1"></i> Confirmar Baixa
				</button>
			</div>
		</div>
	</div>
</div>

@section ScriptsBlock {
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" crossorigin="anonymous" />
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

	<!-- Kendo UI 2022.1.412 - COMPATÍVEL com Telerik Reporting 18.x -->
	<link href="https://kendo.cdn.telerik.com/2022.1.412/styles/kendo.common.min.css" rel="stylesheet" />
	<link href="https://kendo.cdn.telerik.com/2022.1.412/styles/kendo.default.min.css" rel="stylesheet" />
	<script src="https://kendo.cdn.telerik.com/2022.1.412/js/kendo.all.min.js"></script>

	<!-- PDF.js -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
	<script>
		window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.min.js';
	</script>

	<!-- Telerik Report Viewer -->
	<script src="/api/reports/resources/js/telerikReportViewer"></script>

	<!-- Sistema de Ocorrências Múltiplas -->
	<link href="~/css/viagens/ocorrencia-viagem.css" rel="stylesheet" asp-append-version="true" />
	<script src="~/js/viagens/ocorrencia-viagem.js" asp-append-version="true"></script>
	<script src="~/js/viagens/ocorrencia-viagem-popup.js" asp-append-version="true"></script>

	<script src="~/js/cadastros/ViagemIndex.js" asp-append-version="true"></script>
}
